<?php header('Cache-Control: max-age=31536000, public'); ?>

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Manny~Zone:X</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link type="text/css" rel="stylesheet" href="main.css">
           
           <script async>
               let micOn = false;
               let audioX;

              let analyser;
               let source;
               let dataArray;

               async function startMic() {
                 //https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia
                   navigator.mediaDevices.getUserMedia({
                   audio: true,
                   autoGainControl: false,
                   echoCancellation: false,
                   noiseSuppression: false//https://stackoverflow.com/questions/71978189/lag-when-playing-mic-audio-directly-to-output-using-web-audio-api
                   })
                 .then((stream) => {
                   /* use the stream */
                     audioX = new AudioContext();
                     analyser = audioX.createAnalyser();
                     source = audioX.createMediaStreamSource( stream );
                     source.connect(analyser);
                     analyser.fftSize = fftSize;
                     dataArray = new Uint8Array( bufferSize );
                     //init();
                 }).catch((err) => {// engage touch only mode
                                   console.log("Touch only mode!")
                                   touchOnlyMode=true;
                                   window.touchMode = true;
                                   })
                 .finally((err) => {
                   micOn = true;
                 });
               }
               startMic();
           </script>

           
    </head>
    
    <body>
        <script src="OFFLINEonlineSwitch.js"></script>

        <script src="starshipMod.js"></script>
        
        

    <div class=onofflineBG id="background_wrap">
        <script>
            //splash
            let nf = document.querySelectorAll('.onofflineBG');
            if(window.online)
            {
                if(Date.now()%2==1) nf[0].style = "background-image: url('https://cdn.jsdelivr.net/gh/Z1X1Z/zonex_jsdelivr@6/z1xlogo.png');"
                else nf[0].style = "background-image: url('https://cdn.jsdelivr.net/gh/Z1X1Z/zonex_jsdelivr/pentaloctalwtTtlzonexmonogram.jpeg');"
           }
            else
            {
                if(Date.now()%2==1)nf[0].style = "background-image: url('z1xlogo.png');"
                else nf[0].style = "background-image: url('pentaloctalwtTtlzonexmonogram.jpeg');"
                }
        </script>
    </div>

    
        <script>
            function loadScript(element, url, offlineURL)
            {

                // Adding the script tag to the head as suggested before
                var scr = document.getElementById(element);//document.createElement("script");//
                scr.type = 'text/javascript';
                scr.src = url;
                // Then bind the event to the callback function.  or at least that's how it goes without the stallLurker in the sonicstarship.  it's stabler. maybe
                // There are several events for cross browser compatibility.
                //script.onreadystatechange = callback;
                //script.onload = callback;
                scr.onerror=function(){    var s = document.createElement("script");//document.getElementById('threeJSscript');
                    s.type = 'text/javascript';
                    s.src = offlineURL;
                    document.body.appendChild(s);
                    }
            }
          </script>
        
<script id="threeJSscript" async></script>
<script async>
    var cdnSwitchThree="three.js";
    if (window.online)cdnSwitchThree="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js";
    loadScript("threeJSscript",cdnSwitchThree,"three.js")
</script>

<script id="wadJSscript"></script>
<script>
    var cdnSwitchWAD="wad.min.js";
    if (window.online)cdnSwitch="https://unpkg.com/web-audio-daw@4.12.0";
    loadScript("wadJSscript",cdnSwitchWAD,"wad.min.js")
</script>


<script id="osmdJS" async></script> <!-- you need to provide the .js file, see README.md-->
<script async>
    var cdnOSMD="opensheetmusicdisplay.min.js";
    if (window.online)cdnOSMD="https://unpkg.com/opensheetmusicdisplay@1.6.1/build/opensheetmusicdisplay.min.js";
    loadScript("osmdJS",cdnOSMD,"opensheetmusicdisplay.min.js")
 </script>



    <div id="allText">
        <div id="HK"></div>
        <div id="textWindow"></div>
    <script src="hotkeys.js" defer></script>



    <div class="navbar">
        <div class="dropdown">
          <button class="dropbtn">Starship
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
              <input type="checkbox" id="Game On" name="t"  onclick= "
                  key  = 'e';
                  callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               <label for="Game On">Game On!</label><br>
              <input type="checkbox" id="Star Arms" name="t"  onclick= "
                  key  = '_';
                  callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               <label for="Star Arms">Star Arms!</label><br>
               <input type="checkbox" id="Fullscreen" name="t"  onclick= "
                   key  = 'h';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                <label for="Fullscreen">Fullscreen!</label><br>
                <input type="checkbox" id="Verbose" name="t"  onclick= "
                    key  = 'v';
                    callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                 <label for="Verbose">Verbose!</label><br>
               <input type="checkbox" id="Volume Speed" name="t"  onclick= "
                   key  = 'w';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                <label for="Volume Speed">Volume Speed!</label><br>

              <input type="checkbox" id="Touch" name="t"  onclick= "
                  key  = 't';
                  callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               <label for="Touch">Touch!</label><br>
               
               <input type="checkbox" id="Note Stars" name="t"  onclick= "
                   key  = 'P';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                <label for="Note Stars">Note Stars!</label><br>
                
                <input type="checkbox" id="StarClover" name="t"  onclick= "
                    key  = 'O';
                    callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                 <label for="StarClover">Star in Clover!</label><br>
                 
                 
                 <input type="checkbox" id="TrailOverflowsClover" name="t"  onclick= "
                     key  = 'Z';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                  <label for="TrailOverflowsClover">Trail overflows clover!</label><br>
                
               <a id="Star Stream" name="t"  onclick= "

                   key  = 'V';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Star Stream!</a><br>
               
               <a id="Clockwise Spin" name="t"  onclick= "

                   key  = 'D';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Clockwise Spin!</a><br>
               
               <a id="Counter Clockwise Spin" name="t"  onclick= "

                   key  = 'A';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Counter Clockwise Spin!</a><br>
               
               <a id="Shift Up" name="t"  onclick= "

                   key  = 'W';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Shift Up!</a><br>
               <a id="Shift Down" name="t"  onclick= "

                   key  = 'S';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Shift Down!</a><br>
               <a id="Star Spin" name="t"  onclick= "

                   key  = 'Q';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Star Spin!</a><br>
               
               
               <a id="Cancel Background Noise" name="t"  onclick= "

                   key  = 'p';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   Cancel Background Noise!</a><br>
               
               
               <a id="Listen Out" name="t"  onclick= "
                   key  = 'o';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               listen Out!</a><br>
               <a id="Listen In" name="t"  onclick= "
                   key  = 'i';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               listen In!</a><br>


               <a id="Faster" name="t"  onclick= "
                   key  = '+';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               Faster!</a><br>
               <a id="Slower" name="t"  onclick= "
                   key  = '-';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               Slower!</a><br>
               <a id="Reset Speed" name="t"  onclick= "
                   key  = '0';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               Reset Speed!</a><br>

          </div>
          </div>
        <div class="dropdown">
          <button class="dropbtn">Clovers
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">

                 <a id="Add a petal" name="t"  onclick= "
                     key  = 'u';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                 Add a petal!</a><br>
                 <a id="Remove a petal" name="t"  onclick= "
                     key  = 'y';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                 Remove a petal!</a><br>
                <input type="checkbox" id="Center" name="t"  onclick= "
                    key  = 'c';
                    callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                 <label for="Center">Center</label><br>
                 <input type="checkbox" id="Zoom Static" name="t"  onclick= "
                     key  = 'l';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                  <label for="Zoom Static">Zoom Static</label><br>
                  <input type="checkbox" id="Clovers Pop" name="t"  onclick= "
                      key  = 'n';
                      callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   <label for="Clovers Pop">Clovers Pop?!</label><br>
                   
                   <input type="checkbox" id="Clovers Slide" name="t"  onclick= "
                       key  = 'H';
                       callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                    <label for="Clovers Slide">Clovers Slide!</label><br>
                    
                    <input type="checkbox" id="Dancer" name="t"  onclick= "
                       key  = 's';
                       callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                    <label for="Dancer">Dancer!</label><br>

                         <input type="checkbox" id="Reverse Colors" name="t"  onclick= "
                             key  = ';';
                             callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                          <label for="Reverse Colors">Reverse Colors!</label><br>

                          <input type="checkbox" id="Remediate Colors" name="t"  onclick= "
                              key  = 'R';
                              callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                           <label for="Remediate Colors">Remediate Colors!</label><br>

                           <input type="checkbox" id="Inherited Colors" name="t"  onclick= "
                               key  = 'K';
                               callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                            <label for="Inherited Colors">Inherited Colors!</label><br>



                           <input type="checkbox" id="Refractelate" name="t"  onclick= "
                               key  = '!';
                               callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                            <label for="Refractelate">Refractelate!</label><br>


                            <input type="checkbox" id="Clovoid" name="t"  onclick= "
                                key  = '@';
                                callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                             <label for="Clovoid">Clovoid!</label><br>
                             
                             <input type="checkbox" id="144000" name="t"  onclick= "
                                 key  = 'J';
                                 callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                              <label for="Clovoid">144000!</label><br>
                              <input type="checkbox" id="Spoker" name="t"  onclick= "
                                  key  = 'T';
                                  callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                               <label for="Spoker">Spoker!</label><br>
                               <input type="checkbox" id="SpokeLove" name="t"  onclick= "
                                   key  = 'F';
                                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                                <label for="SpokeLove">Spoke Love!</label><br>
                                
                                <input type="checkbox" id="Continuum Clover" name="t"  onclick= "
                                    key  = '&';
                                    callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                                 <label for="Continuum Clover">Continuum Clover!</label><br>
                                 
                                 
                                 
                <form>

                      <input type="radio" id="OriginalOrange" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=7;">
                      <label for="OriginalOrange">Original Orange!</label><br>
                  <input type="radio" id="GreenAndPink" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=2;">
                  <label for="GreenAndPink">Green and Pink!</label><br>
                  <input type="radio" id="OddOrange" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=3;">
                  <label for="OddOrange">Odd Orange!</label><br>
                  <input type="radio" id="YellowAndPurple" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=4;">
                  <label for="YellowAndPurple">Yellow and Purple!</label><br>

                  <input type="radio" id="BlueAndPink" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=5;">
                  <label for="BlueAndPink">Blue and Pink!</label><br>

                  <input type="radio" id="Glowing" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=6;">
                  <label for="Glowing">Glowing!</label><br>

                    <input type="radio" id="Rainbow" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=1;">
                    <label for="Rainbow">Rainbow!</label><br>

                      <input type="radio" id="Inheritance" name="colorMode" onclick="uniforms[ 'colorCombo' ].value=8;">
                      <label for="Inheritance">Inheritance!</label><br>
                </form>

                <br>


                <form>
                  <input type="radio" id="Up" name="carousel" onclick="uniforms[ 'carousel' ].value=-1;">
                  <label for="Up">Carousel Up!</label><br>
                  <input type="radio" id="Down" name="carousel" onclick="uniforms[ 'carousel' ].value=1;">
                  <label for="Down">Carousel Down!</label><br>
                  <input type="radio" id="Off" name="carousel" onclick="uniforms[ 'carousel' ].value=0;">
                  <label for="Off">Carousel Off</label>

                </form>
                <br>

                <form>
                  <input type="radio" id="mUp" name="mcarousel" onclick="uniforms[ 'metaCarousel' ].value=-1;">
                  <label for="mUp">Meta-Carousel Wise One!</label><br>
                  <input type="radio" id="mDown" name="mcarousel" onclick="uniforms[ 'metaCarousel' ].value=1;">
                  <label for="mDown">Meta-Carousel Wise 2!</label><br>
                  <input type="radio" id="mOff" name="mcarousel" onclick="uniforms[ 'metaCarousel' ].value=0;">
                  <label for="mOff">Meta-Carousel Off</label>
                </form>
                <br>

            <form>
              <input type="radio" id="SpirallizeOriginal" name="Spirallize" onclick="uniforms[ 'spirated' ].value=1;">
              <label for="SpirallizeOriginal">Spirallize Original!</label><br>
              <input type="radio" id="SpirallizeMirror" name="Spirallize" onclick="uniforms[ 'spirated' ].value=-1;">
              <label for="SpirallizeMirror">Spirallize Mirror!</label><br>
              <input type="radio" id="SpirallizeOff" name="Spirallize" onclick="uniforms[ 'spirated' ].value=0;">
              <label for="SpirallizeOff">Spirallize Off</label>

            </form>

                      </div>
        </div>
        
        <div class="dropdown">
          <button class="dropbtn">Extras
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
               <input type="checkbox" id="Friends" name="t"  onclick= "
                   key  = 'f';
                   callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                <label for="Friends">Friends!</label><br>
                <input type="checkbox" id="Bridge" name="t"  onclick= "
                    key  = 'z';
                    callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                 <label for="Bridge">Bridge!</label><br>
                 <input type="checkbox" id="Wheel" name="t"  onclick= "
                     key  = 'm';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                  <label for="Wheel">Wheel!</label><br>
                  
                  <input type="checkbox" id="Articles" name="t"  onclick= "
                      key  = 'G';
                      callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                   <label for="Articles">Articles!</label><br>
                   
                   <input type="checkbox" id="Blank Background" name="t"  onclick= "
                       key  = 'Y';
                       callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                    <label for="Blank Background">Blank Background!</label><br>
                   
                 <a id="Cycle Character" name="t"  onclick= "
                     key  = 'U';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                     Cycle character!</a><br>
                 
                 <a id="Metronome Up" name="t"  onclick= "
                     key  = '.';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                     Metronome Up!</a><br>

                 <a id="Metronome Down" name="t"  onclick= "
                     key  = ',';
                     callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                     Metronome Down!</a><br>

                  <a id="Manny" name="t"  onclick= "
                      key  = 'g';
                      callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                      Manny!</a><br>


                  <a id="Acrostic" name="t"  onclick= "
                      key  = '$';
                      callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                      Acrostic!</a><br>

                   <a id="ToLToK" name="t"  onclick= "
                       key  = 'd';
                       callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                       ToLToK!</a><br>

                    <a id="Mandelbrot" name="t"  onclick= "
                        key  = 'a';
                        callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                        Mandelbrot!</a><br>

                     <a id="Refractelbrot" name="t"  onclick= "
                         key  = 'r';
                         callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
                         Refractelbrot!</a><br>

           <a id="XSquared" name="t"  onclick= "
               key  = 'x';
               callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
               XSquared!</a><br>

         <a id="ToLX" name="t"  onclick= "
             key  = 'b';
             callKey(new KeyboardEvent('keydown', {'key': key, 'keyCode':key.charCodeAt(0)}));">
             ToLX!</a><br>
        </div>
    </div>
    </div>
    </div>
    
    <script>let n = document.getElementsByName('t');
        for(var p = 0; p<n.length;p++)n[p].checked  = false; </script>
    
    
    <div id="container"></div>
    
    <script src="wadLoader.js" dynamic> </script>

    <div id="score">
        <div id="osmdCanvas"/>
        <input type="file" id="files"/>
        <output id="list"></output>
        <script src="fileSelectAndLoadOSMD.js" async></script>
    </div id="score">
    
    
    
<script id="vertexShader" type="x-shader/x-vertex" defer>

        varying vec2 vUv;

    void main()    {

        vUv = uv;
        gl_Position = vec4( position, 1.0 );
    }
</script>

<script id="fragmentShader" type="x-shader/x-fragment" defer>

    varying vec2 vUv;
    uniform bool helm;
    uniform sampler2D STAR;
    uniform bool Spoker;
    uniform bool spokelover;
    uniform bool continuumClover;
    uniform bool cloverSlide;
    
    uniform bool Inherited;
    uniform bool spokesVisualizeColors;
    uniform vec2 coords;
    vec2 spunC=vec2(0.);
    uniform vec2 d;

    uniform vec2 resolution;

    uniform int colorCombo;
    uniform bool colorInverter;

    uniform float time;
    uniform float volume;

    uniform float rate;
    uniform float zoom;
    uniform float metronome;

    uniform float time2dance;
    uniform int fourCreats;
    uniform int Character;
    uniform bool articles;


    uniform bool MetaCored;//used for freezing current zoom level
    uniform bool outerCoresOff;//used for isolating coring to central core

    uniform bool free;

    uniform float morph;

    uniform float carousel;
    uniform float metaCarousel;
    uniform float petals;

    uniform float spirated;

    uniform bool hearTOL;

    uniform bool wheel;
    uniform bool Refractelate;
    uniform float centralCores;
    uniform float externalCores;
uniform bool Clovoid;
uniform bool remediatedColors;
uniform bool dotted;
uniform bool onehundredfortyfourthousand;
uniform float shaderScale;
    const float PI = 3.1415927410125732;
    const float gr = 1.618033988749;
    float zin(float x){return -sin(x);}
    float coz(float x){return -cos(x);}

    vec3 heart(vec2 g, vec2 t){
        //g.x-=.5;
        g.y*=-1.;
        vec2 z=g.xy;
    vec3 h=vec3(0.);
        for (int f=0;f<60;f+=1)if(abs(z.y+z.x)>2.){h=vec3(0.);break;}
        else {z=vec2(((z.x*z.x-z.y*z.y)-g.x+t.x),(2.0*z.x*z.y-g.y+t.y));//mandelbrot loop factored into real and imaginary components from z<=z^2-g
          h+=vec3(z.x*z.y,z.x,z.y)/21.;}
    return h;
    }
      vec3 face(vec2 g, vec2 t){
      float l = 1.;
      g*=gr;
      vec2 z=g.xy;
      if(g.x*g.x+g.y*g.y<40.)
      for (int f=0;f<21;f+=1)if(abs(z.y)>21.&&(f==1||f>3)){
          if (f==1){l=1.;break;}
          l=1.-length(z)/40.;//clouds and face
          break;}
      else{
          z=vec2(-1./(z.x*z.x-z.y*z.y-g.x),2.0*z.x*z.y-g.y);
          l=abs(z.y)*6.;//smooths middle horn, removes some clouds
          if(z.x>-.1)l=z.x*50.;}//face with closed small holes
      return vec3(clamp(1.-l,0.,1.));
      }
    
      vec3 clouds(vec2 g, vec2 t){
      float d = 0., negator = 1.;
      g*=gr;
      vec2 z=g.xy;
      //if(g.x*g.x+g.y*g.y<40.)
      if(abs(z.y)<21.)
          z=vec2(-1./(z.x*z.x-z.y*z.y-g.x),2.0*z.x*z.y-g.y);
      if(abs(z.y)>21.) {
         // z=vec2((z.x*z.x-z.y*z.y-g.x),2.0*z.x*z.y-g.y);
          d=length(z)*441.144;
          }
      else negator = 0.;
     return vec3(-sin(d +time*3.+6.28318/3.),-sin(d+time*3.+6.28318*2./3.),-sin(d+time*3.))*negator;

      }

 vec3 shiny(vec2 p,vec2 t){
    p*=gr;
     vec2 s = p;
     float l=0., d = 0., negator = 1.;
         for (int f=0;f<21;f+=1)
         if(abs(s.y)>21.&&(f==1||f>2)){
             l=1.-length(s)/40.;
             if (f == 1)
                     negator=0.;
             else
                     d+=length(s)/10.;
             break;
         }
         else{
             s=vec2(-1./(s.x*s.x-s.y*s.y-p.x+t.x/7.), 2.0*s.x*s.y-p.y+t.y/7.);
             l=abs(s.y)*3.5;//refines middle horn, optional
             if(s.x>-.1)l=s.x*50.;//closes small holes
             d+=length(s)/10.;
         }
         if (l>.54) negator = 0.;
         return vec3(-sin(d *3.+PI*2./3.),-sin(d*3.+PI*2.*5./3.),-sin(d*3.))*5.*negator;
 }

    
vec3 faceHeights(vec2 g, vec2 t){
float l = 1.;
g*=2.;
vec2 z=g.xy;
if(g.x*g.x+g.y*g.y<40.)for (int f=0;f<21+6*5;f+=1)if(abs(z.y)>19.&&(f==1||f>3)){
    if (f==1){l=1.;break;}
    l=1.-length(z)/40.;//clouds and face
    break;}
else{
    z=vec2(-1./(z.x*z.x-z.y*z.y-g.x+t.x),2.0*z.x*z.y-g.y+t.y);
    l=abs(z.y)*5.;//smooths middle horn, removes some clouds
    if(z.x>-.1)l=z.x*50.;}//face with closed small holes
return vec3(clamp(1.-l,0.,1.));
}
    
                vec2 freed(vec2 p){
                    if(free){
                        float shift = 3.;
                        p+=shift/2.;
                        p=(mod(abs(p),shift));
                        p-=shift/2.;
                    }
                    return p;
                    }

                    vec3 torso(vec2 g, vec2 t){
                    float b = 0.;
                    vec2 z=g.xy;
                    if(g.x*g.x+g.y*g.y<40.)if (g.x>0.)for(int f=0;f<12;f+=1)if(abs(z.y)>52.&&f>4){b=abs(z.y)/77.;break;}
                    else{
                        z=2.*vec2(-1./(z.x*z.x-z.y*z.y-g.x+t.x),(2.0*z.x*z.y-g.y+t.y));
                        z.x=sqrt(abs(z.x));}
                    return vec3(b,b/2.5,0.);
                    }
                    vec3 musculature(vec2 g, vec2 t){
                    float m=0.;
                    g.x+=.54;
                    vec2 z=g.xy;
                    if(g.x>1.25&&abs(g.y)<2.5)for(int f=0;f<15;f+=1)if(abs(z.y)>15.&&f>7&&f!=15){m=abs(z.y)/25.;break;}
                    else {
                        z=1.3*vec2(-1.5/((z.x*z.x-2.*z.y*z.y)-g.x+t.x),(1.9*z.x*z.y-1.87*g.y+t.y));
                        z.x=pow(abs(z.x),.57);}
                    return vec3(m,m,m/2.);
                    }
                    vec3 robe(vec2 g, vec2 t){
                    float r=0.;
                    g.x+=.05;
                    g.y/=1.14;
                    vec2 z=g.xy;
                    if(abs(g.y)<3.)for(int f=0;f<70;f+=1)if(abs(z.y)>11.&&f>7){r=clamp(1.7-abs(g.x-2.3)
                                     //*(1.-abs(g.y*g.x))-.07//(un)comment this line to toggle sleeves
                                    ,0.,1.);break;}
                    else{
                        z=1.1*vec2(-2./((z.x*z.x-1.8*z.y*z.y)-g.x),(3.*z.x*z.y-1.3*g.y+t.y));;
                        z.x=pow(abs(z.x),.8);}
                    return vec3(r);
                    }
                    vec3 legs(vec2 g, vec2 t){
                    float b=0.;
                    g/=2.;
                    vec2 z=g.xy;
                    if(g.x>.75&&g.x<1.7&&abs(g.y*g.x)<.57)for(int f=0;f<8;f+=1)if(abs(z.x)>52.&&f>1){b=abs(z.x)/70.;break;}
                    else{
                        z=3.*vec2(-1./(z.x*z.x-z.y*z.y-g.x+t.x*sign(-g.y)),77.*z.x*z.y-g.y+t.y);
                        z.y=-1./z.y;}
                    return vec3(b/2.,b,b/2.);
                    }



                vec2 spin2(vec2 f, float t)
                {    //https://en.wikipedia.org/wiki/Rotation_matrix
                    float angle =t;
                    float fxb=f.x;
                    f.x=f.x*cos(angle)-f.y*sin(angle);
                 f.y=fxb*sin(angle)+f.y*cos(angle);
                 return f;
                }
vec3 sealedMan(vec2 p,vec2 t)
{
p.x+=2.;
float r, b, l;
    //person--a body derived to have a head of its own
        vec2 z=p;
        for(int f=0;f<20;f+=1)if(abs(z.y)>50.&&f>4)l=1.;
        else{z=2.*vec2(1./(z.x*z.x-z.y*z.y-p.x+t.x),2.0*z.x*z.y-p.y+t.y);
                 z.x=pow(abs(z.x),.59);}
                
    //robe--came from the body as soon as I looked for clothing
        vec2 g=p;
        g.x+=.05;
        g.y/=1.14;
        z=g;
        if(g.x>.5)for(int f=0;f<70;f+=1)if(abs(z.y)>11.&&f>7)r=clamp(1.44-abs(g.x-2.3)
                                         *(1.-abs(g.y*g.x))-.07//(un)comment this line to toggle sleeves
                                        ,0.,1.);
        else{
            z=1.1*vec2(-2./((z.x*z.x-1.8*z.y*z.y)-g.x+t.x),(3.*z.x*z.y-1.3*g.y+t.y));;
            z.x=pow(abs(z.x),.8);}
    //horse
        g=p;
        g.x-=3.5;
        g.y/=1.14;
         z=g;
        if(g.x*g.x+g.y*g.y<3.)for(int f=0;f<23;f+=1)if(abs(z.y)>11.&&f>7)r=1.;
        else{
            z=1.0*vec2(1./((z.x*z.x-3.*z.y*z.y)-g.x+t.x),2.*(z.x*z.y-g.y+t.y));;
            z.x=pow(abs(z.x),.8);}
    //legs--I found these about hours before finding the body but left them, recovering them from memory
        g=p/2.;
        z=g;
        if(g.x>.75&&g.x<1.7&&abs(g.y*g.x)<.54)for(int f=0;f<8;f+=1)if(abs(z.x)>52.&&f>1)b=abs(z.x)/100.;
        else{
            z=3.*vec2(-1./(z.x*z.x-z.y*z.y-g.x+t.x),77.*z.x*z.y-g.y+t.y);
            z.y=-1./z.y;}
            return vec3(l+b+r);}
    vec3 sealedWoman(vec2 p,vec2 t){
                    p+=2.;
                    
                   vec2 g=p/2.2;
                   vec2 s=g;
                   float l=0.;
                   float n, c, r, x;
                   //vv legs vv
                   if (g.x<1.8 &&g.x>.5 &&abs(g.x*g.y)<.5)for (int f=0;f<10;f+=1)if(abs(s.x+s.y)>200.&&f>4)c=1.;
                     else {s=vec2(-1./((s.x*s.x-s.y*s.y)-g.x+t.x),(67.0*s.x*s.y-.7*g.y+t.y));s*=3.; s.y = -1./s.y; }
                    g = p;
                   s=g;
                   if(g.x*g.x+g.y*g.y*4.<2.||g.x>0.){
                   //vv body vv
                       for (int f=0;f<21;f+=1)if(abs(s.x+s.y)>12.&&f>7)l=1.;
                          else {s=vec2(-1.5/((s.x*s.x-2.*s.y*s.y)-g.x+t.x),(1.7*s.x*s.y-1.2*g.y+t.y));s*=1.3; s.x=pow(abs(s.x),.6125 );  }
                g=p;
                        s=g;
                   //vv body vv
                       for (int f=0;f<30;f+=1)if(abs(s.x+s.y)>20.&&f>4)x=1.;
                       else {s=vec2(-1.5/((s.x*s.x-2.*s.y*s.y)-g.x+t.x),(1.7*s.x*s.y-1.34*g.y+t.y));s*=1.7; s.x=pow(abs(s.x),.549 );  }
                     }
                         //vv robe vv
                   g=p;
                   g.x+=-.3;
                   s=g;
                   if (g.x>.50)for (int f=0;f<20;f+=1)if(abs(s.x+s.y)>11.&&f>7)r=clamp(1.4-abs(g.x-2.3)
                                                                                         *(1.-abs(g.y*g.x))-.07//(un)comment this line to toggle sleeves
                                                                                        ,0.,1.);
                   else {s=vec2(-2./((s.x*s.x-2.4*s.y*s.y)-g.x+t.x),(3.*s.x*s.y-1.3*g.y +t.y));s*=1.11; s.x=pow(abs(s.x),.8 );
                       }
                   return clamp(vec3(l+x+r+c),0.,1.);
               }
vec2 jc =vec2(0.);// vec2 jc =vec2(-0.5577,- 0.6099);//you can feed in coordinates for p movement to get different cloverfields
vec3 tol(vec2 p, vec2 t){
vec2 colorAccumulator =vec2(0.);
vec3 heartColors = vec3(0.);
float cored =0.;
if(MetaCored)cored= log(zoom)/log(.5);
else cored = centralCores;
float c = length(p);
float loops=0.;
vec2 s=p;
float coresIn = 0.;
const float crs = 63.;
// if(c>4./3.){s/=2.;c/=2.;}//Engage one UpCore, the rest of zoom cycle in StarshipMod.js
 float centerslide = 0.;
if (zoom<1.)  for(int i=0;i<int(crs); i++)if(c<2./3.&&loops+centerslide<cored){
  if (cloverSlide)  centerslide-=length(s);
  s*=2.;c*=2.;loops++;coresIn++;}
 else break;
//  else if(zoom>1.)for(int i=0;i<int(crs); i++)if(c>4./3.&&loops<-cored){s/=2.;c/=2.;loops++;coresIn++;}else break;//UpCore not in use here, but rather in the starshipMod
for(int i=0;i<int(crs); i++)if(c<2./3.&&loops<cored){s*=2.;c*=2.;loops++;coresIn++;}else break;
float lfc = length(freed(coords));

loops=0.;
float hyperCore=0.;
float logStabilizationConstant = 1./log(3.)+(1.-1./log(3.))/2.;//.9551195 is based on 1./log(3.)==0.910239 So (1.-.910239)/2+.910239=.9551195 May be incorrect but is close to right.
if(MetaCored)hyperCore=cored*2./3.+log(lfc)*logStabilizationConstant;
else hyperCore=externalCores;//hyperCore is really better thought of as hyperMetaCore
if(outerCoresOff)hyperCore=0.;

if(Spoker&&MetaCored)hyperCore*=4./3./logStabilizationConstant;//engage overstable core if dancing
 if(morph>.5)hyperCore+=3.;
 float term=0.;
if (spirated!=0.)term=(lfc)*(3.-2.7182818);//if is spirated then oscillate the function's log between e and 3
vec2 m=vec2(0.);

//Maendel clover
if(wheel)m =  (p/lfc-abs(coords.yx)//try signs with for fibonacci ring pairing and movement distortion #syyym
)*abs(coresIn/crs*2.-1.);
//this is essentially just p as in the mandelbrot x <== x^2+

                            const float iterations = 40.;
                            float refractelC=1.5;
                        //  p*=2.*refractelC;
vec3 oo = vec3(0.);
 float continuumCounter=0.;

vec4 starship=vec4(0.);
float minToMax=min(resolution.x,resolution.y)/max(resolution.x,resolution.y);
for (float counter=0.;counter<iterations;counter++)if(length(s)<50.){
           
 if(length(s)<2./3.||(spokesVisualizeColors&&length(s)<4./3.)) starship+= texture2D(STAR,(spin2(vec2(s.y,-s.x),-atan(s.y,s.x)*petals/(6.+petals)-atan(d.x,d.y)+PI
    ))/2.+.5);//doesn't remap clovers 8+
                         
 
if(onehundredfortyfourthousand)
{
 
 int march= int(hyperCore)%4;
 float color = 1.;
 if (march==1||march==3)color = -1.;
 if(length(s)<2./3.)
 {
     vec2 move =-d.yx*volume/8.;
     if(march==0||march==3)oo+=color*sealedMan(s*5.,move);
     else oo+=color*sealedWoman(s*5.,move);
 }
                          
}
if(spirated!=0.&&length(s)<2./3.)   s*=length(s)*PI/(atan(s.y,s.x)-PI*spirated);

   colorAccumulator+=s;
   if(Refractelate&&length(s)>refractelC){s/=refractelC;} //refractelC/=4./3.;}

   s=vec2(
        s.x*s.x*s.x  - 3.*s.x*s.y*s.y,
       -s.y*s.y*s.y+ 3.*s.x*s.x*s.y
       );//x**3
   
       if(dotted)s/=dot(-m,t)*dot(m,-t);

      // if(spirated!=0.)
   s+=m-t;
//    else s+=t-m;//plus t is lobes, -t is circles with dance
   
       if(Clovoid)s.x=(sqrt(2.*abs(1./s.x)));//this is the body steps on the clover
       else if(colorCombo==8||colorCombo==9)s.x=-1./s.x;//this is just the face (without or with +c), inheritance is the only
   
   
s.x=log(abs(s.x))/log(3.-term);
   

    if(Spoker&&loops+counter+1.<=hyperCore) s/=2.;//engage spokelover
   
   if(spokelover&&counter<hyperCore){
        if(continuumClover) s*=sqrt(2.);//engage shiny spokelover
        else s/=sqrt(2.);
        }
   
   
   if(continuumClover){//engage continualization
       float continuumCore=(-loops-counter+continuumCounter+hyperCore)*zoom/(lfc-zoom);
       if(loops+counter<hyperCore+continuumCounter) s/=pow(2.,pow(.5,continuumCore));
        continuumCounter+=continuumCore;
    }
  
   float distance = length(s);
   

if(distance<4./3.&&petals!=0.)s=spin2(s,atan(s.y,s.x)*petals/6.);
   
   
   float mcc=-1./log(.5);//cycle frequency mudulated loop counter
   
for(int i=0;i<20; i++)
if(distance<2./3.&& loops+counter-continuumCounter<hyperCore)//not sure if i is 20 or >20
{
    
    bool energyField=false;
           if(energyField){//meta continualization
                float continuumCore=pow(2.718,1./(hyperCore-mcc));//(hyperCore-mcc)*zoom/(zoom-lfc));
               //  float continuumCore = (hyperCore-mcc)*distance*zoom/(zoom-lfc);
                if(counter-continuumCounter<=hyperCore-mcc)
                {
                           s*=pow(2.,pow(.5,continuumCore));
                    distance*=pow(2.,pow(.5,continuumCore));
                    //mcc+=1.;
                }
             }
           
           if (cloverSlide)  loops-=distance;

 s*=2.;distance*=2.;loops++;


  float wise;
  if(mod(float(i),4.)==0.)wise=1.;
  else if(mod(float(i),4.)==1.)wise=-1.;
  else  if(mod(float(i),4.)==2.)wise= -1.;
  else  if(mod(float(i),4.)==3.)wise=1.;

  if(metaCarousel!=0.)s=spin2(s,time*wise*metaCarousel*(1.+petals/6.)*rate);

}
else break;

}else break;


vec3 o = vec3(colorAccumulator.x*colorAccumulator.y);
                     if(colorCombo==7) o=vec3(s.y,s.x/9.5,1.-s.x/12.);
                     else if(colorCombo==2) o=vec3(s.y/100.-s.x*s.y/888.+s.y/50000.,s.x/8.-s.y/s.x/2000.,1.-s.x/20.+s.y/50000.);
                     else if(colorCombo==3) o= vec3(s.x/8.-s.y/s.x/7000.,1.-s.x/16.,s.y/100.);
                     else if(colorCombo==4) o= vec3(1.-s.x/20.,s.x/8.-s.y/s.x/2000.,s.y/35.-s.x*s.y/888.);
                     else if(colorCombo==5)  o=vec3(s.y/40.-s.x*s.y/888.,1.-s.x/21.,s.x/6.-s.y/s.x/2000.);
                     else if(colorCombo==6) o=  vec3(-sin(time*1.)*s.y/100.-sin(time*gr)*s.x*s.y/888.,s.x/8.-sin(time*(-gr+1.))*s.y/s.x/2000.,1.-sin(time*(gr+1.))*s.x/20.);
                    else if(colorCombo==1) {
                              o= (1.-(vec3(s.y/125.-s.x*s.y/888.+s.y/25000.,s.x/8.-s.y/s.x/2000.-s.y/25000.,1.-s.x/20.+s.y/25000.)
                                           *vec3(1.-s.x/20.,s.x/8.-s.y/s.x/2000.,s.y/35.-s.x*s.y/888.)
                                           *vec3(s.y/40.-s.x*s.y/888.,1.-s.x/21.,s.x/6.-s.y/s.x/2000.)));
                                                }
                                else if(colorCombo==8) {
                                            s=-colorAccumulator*(coresIn+1.)*((coresIn+2.)/(60.+1.)-.5);

                                            o= (1.-(vec3(abs(s.y)-s.x*s.y/888.+s.y/25000.,s.x/20.-s.y/s.x/2000.-s.y/25000.,1.-s.x/20.+s.y/25000.)
                                                         *vec3(1.-s.x/20.,s.x/8.-s.y/s.x/2000.,s.y/35.-s.x*s.y/888.)
                                                         *vec3(s.y/40.-s.x*s.y/888.,1.-s.x/21.,s.x/6.-s.y/s.x/2000.)));
                                                              }
   else if(colorCombo==9) {
  //   if(wheel)heartColors=(vec3(s.x*s.y,s.x+.2,s.y-.3*(1.-s.x))+.3)/length(s);

   float colorFlip=-abs(coresIn-crs/2.)*sign(coresIn/crs*2.-1.);
         s=colorAccumulator*(coresIn/crs*2.-1.);

                  o=((coresIn-(crs/2.))/(crs/2.)-vec3(-s.x,s.y,-s.x*s.y).zxy//try swizzling these
                  *sign(crs/2.-coresIn))
                  *(1.-vec3(s.y-s.x*s.y/888.+s.y/25000.,s.x/8.-s.y/s.x/2000.-s.y/25000.,1.-s.x/20.+s.y/25000.)
                               *vec3(1.-s.x/15.,s.x/8.-s.y/s.x/20.,-abs(s.y)/35.-s.x*s.y/100.)
                               *vec3(s.y/40.-s.x*s.y/888.,1.-s.x/21.,s.x/6.-s.y/s.x/200.));
                      }
                      
                      
                      
                      if(Inherited)o*=vec3(1.-colorAccumulator.x/colorAccumulator.y);

                      
          if(colorInverter==true){
                      o.r*=-sin(time);
                      o.g*=abs(-sin(time*gr));
                      o.b*=-sin(time*1./gr);
                        }

                                if(remediatedColors)
                                {
                                o/= max(max(o.r,o.g),o.b);
                                 o=o*.5+.5;
                                 }
  float isBlack =1.;
  if (starship.x+starship.y+starship.z==0.&&starship.w!=0.)isBlack=0.;
  else if(starship.x==starship.y&&starship.x==starship.z&&abs(starship.z-.5)<.1&&starship.w!=0.) isBlack=.5;
o=(clamp((clamp(o-1000000000000.*oo,0.,1.)+oo)-vec3((starship.x+starship.y+starship.z)*(starship.w*starship.w)),0.,1.)+starship.xyz*isBlack);
return clamp(o,0.,1.);}

                      
                      
                      
                      
                      
                      
  
  
  
  vec3 MannyWoManny(vec2 p,vec2 t){

                               float time2 = t.x;
                               float c=0.,k=0.,l=0.,x=0.,e=0.;
                               vec3 head;
              if(abs(p.y*p.y)+abs(p.x*p.x)<700.){
                 // t.y=t.x;
                           //vv body vv
                               vec2 g=p;
                                ///g.x+=(coz(t.y)-1.)/2.*.5;
                               vec2 z=g;
                               if(abs(p.y)<6.)for (int f=0;f<30;f+=1)if(abs(z.x+z.y)>(20.-(coz(t.y)-1.)/2.*50.)&&f>4)x+=z.y/20000000.;
                               else {z=2.*vec2(-1./((z.x*z.x-(1.44+(coz(t.x)-1.)/2.*.44)*z.y*z.y)
                            -g.x*(1.2+(coz(t.y)-1.)/2.*.2)),
                       ((1.2-(coz(t.y)-1.)/2.*.8)*z.x*z.y-(1.2+(coz(t.y)-1.)/2.*.2)*g.y));
  //The Holy Bible Revelation 21:16 "The city was laid out like a square, as long as it was wide.
  //He measured the city with the rod and found it to be 12,000 stadia in length,
   //and as wide and high as it is long. The angel measured the wall using human measurement, and it was 144 cubits thick.
                                                         z.x=pow(abs(z.x),(.777+(coz(t.y)-1.)/2.*.277));}



          //legs
                               g=p/2.;
                              // g.x-=.5;
                               z=g;
                               if(g.x>.75&&g.x<1.7&&abs(g.y*g.x)<.54)for(int f=0;f<8;f+=1)if(abs(z.x)>52.&&f>1)c=abs(z.x)/1000000.;
                               else {z=3.*vec2(-1./((z.x*z.x-z.y*z.y)-g.x),(77.0*z.x*z.y-(2.+(coz(t.y)-1.)/2.)*g.y));
                                     z.y = -1./z.y;}
                 //vv head vv
                                       g=p*1.618;
                                       z=g;
                          if(abs(p.y)<4.)for (int f=0;f<21;f+=1)if(abs(z.y)>21.&&(f==int(floor(.8-(coz(t.y)-1.)/2.*.4)))){l=0.;break;}
                               else if(abs(z.y)>19.&&(f>4))l=1.;
                                       else{z=vec2(-1./((z.x*z.x-z.y*z.y)-g.x),2.0*z.x*z.y-g.y);
                            z*=pow(z.x,(z.x-(coz(t.y)-1.)/2.*-z.x));
                            l = clamp(1.-abs(z.y)*6.,0.,1.);
                            if(z.x>-.1&&f!=0)l=clamp(1.-z.x*49.,0.,1.);
                               }

      }

                           return vec3(l)+vec3(c,x+c/2.,0.)*10000.+clamp(vec3(0.,(k+e)*10.,(k+e)*10.),0.,1.);}


vec3 robeL(vec2 g, vec2 t){
     float r=0.;
     g.x*=(1.2+(coz(t.y)-1.)/2.*.2);
     g.x+=(-.45-(coz(t.y)-1.)/2.*.5);
     g.y/=1.14;
     vec2 z=g.xy;
     if(g.x>.5 &&abs(g.y)<(.8-(coz(t.y)-1.)/2.*1.0))for(int f=0;f<70;f+=1)if(abs(z.y)>11.&&f>7)r=clamp(1.4-abs(g.x-2.3)
                      *(1.-abs(g.y*g.x))-.07//(un)comment this line to toggle sleeves
                     ,0.,1.);
     else{
         z=1.1*vec2(-2./(((1.2+(coz(t.y)-1.)/2.*.1)*z.x*z.x-1.8*z.y*z.y)-g.x),(3.*z.x*z.y-(1.4+(coz(t.x)-1.)/2.*.1)*g.y));;
         z.x=pow(abs(z.x),.8);}
     return vec3(r);
     }


     vec3 heartZoom(vec2 p, vec2 t){
 
 float c=3.58;
 p.y*=-1.;
 if(colorCombo==18) p*=2.*c;
 vec2 z=p;
const float iterations =  21.*21.;
for (float f=0.;f<iterations;f+=1.)
if(f>(-sin(time/4.)+1.)/2.*iterations*.25+.75){if(length(z)>5.&&colorCombo!=18)break;
else{
if(colorCombo==18)if(length(z)>c)z/=c;
z=vec2(z.x*z.x-z.y*z.y-p.x+t.x, 2.0*z.x*z.y-p.y+t.y);//this is {s=s^2-p}
}}

return (vec3(z.x*z.y,z.x+.2,z.y-.3*(1.-p.x))+.3)/length(z);

 
 }
  
  
  
                      
                      vec3 excelsior(vec2 p,vec2 t){
                                          t.x*=-1.;
                                           p*=gr;
                                           vec2 s=p;
                                           vec3 l=vec3(.1,.5,1.1);
                                               for (int f=0;f<21;f+=1)
                                           if(abs(s.y)<21.){
                                            s=vec2(((s.x*s.x-s.y*s.y)-p.x),(2.0*s.x*s.y-p.y));

                                               s.x=pow(s.x,-sin(t.x*2.+3.14))*sign(-s.x*-sin(-t.x*2.+3.14));
                                                                l=vec3(2.-abs(s.y*-sin(-t.x))*19.)*-sin(-t.x);//middle horn
                                               if(s.x>-.1)l=vec3(-sin(t.x)-(s.x*(100.-100.*-sin(t.x*2.-3.14))*-sin(t.x)));
                                               }
                                       return vec3(1./l);
                               }

     vec3 man(vec2 p,vec2 t) {
         p*=-1.75;
         vec2 s = p;
         float l;
         float flip=-t.x;
         if (flip<0.) p = -p;
         if (abs(p.x*p.x+p.y*p.y)<2.0){for (int t = 0; t < 30; t++) {
                 s = vec2(((s.x * s.x - s.y * s.y) +flip* p.x), (s.x * s.y + flip*p.y));
                 if(flip<1.)
                 s.x = 1./pow(s.x,flip)*sign(s.x*flip);
                 else s.x = 1./s.x;
           l = length(s);

         if (l >20.0&&t!=0)
              return vec3(-2.*zin(time));}
                      return vec3(2.*zin(time));}
         return vec3(0.);
 }


     vec3 eagle(vec2 p,vec2 t) {
     p*=10.;
         vec2 s = p;
         float d = 0.0, l;
         float flip=-t.x;
         if (flip<0.) p = -p;
         if(abs(6.*p.x*p.x+p.y*p.y*2.)<700.0)
         for (int i = 0; i < 30; i++) {
             s=vec2(-(s.x * s.x - s.y * s.y) +flip* p.x, (s.x * s.y + t.y*p.y));
            /* if(b<=.5 ||rate == 0.)
                 s.x = 1./s.x;
             else*/
            if(flip<1.)s.x = 1./pow(s.x,flip)*sign(s.x*flip);
            else s.x=1./s.x;
               s.y = s.x*s.y;
             l = length(s);
             d +=2.;
             if (l >(20.0) ) if( float(i)>3.&&float(i)>3.)
                 return vec3(1.-sin(d * 0.003)-.5,1.- sin(d * 0.9)-.5,1.- sin(d * 0.1)-.5)*3.;}
         return vec3(.0);
        }

      vec3 eaglePerched(vec2 p, vec2 t){
            p*=2.5;
            vec2 s=p;
                    float l = 0.;

                    float flip=-t.x;
                    if (flip<0.) p = -p;
                    if(abs((p.x)*(p.x)+(p.y*p.y))<8.&&p.x<0.1)
            for (int f=0;f<20;f+=1)if(abs(s.x+s.y)>20.)l=1.;
            else {s=vec2((s.x*s.x+s.y*s.y+p.x),-(2.0*s.x*s.y-p.y));

                        if(flip<1.)s.x = 1./pow(s.x,flip)*sign(s.x*flip);
                        else s.x=1./s.x;
                  l=-1.;}
            return vec3(l);
        }

     vec3 lion(vec2 p,vec2 t) {
         p*=-3.;
       vec2 s = -p;

    float d = 0.0, l;

    float flip=-t.x;
    if (flip<0.) p = -p;
    if(p.x*p.x*1.+p.y*p.y*2.<21.)
    for (int t = 0; t < 30; t++) {
        s = vec2(((s.x * s.x - s.y * s.y) +flip* p.x), (2.0* s.x * s.y + flip*p.y));
        s/=2.;
        if(flip<1.) s.x = 1./pow(s.x,flip)*sign(-s.x*flip);
        else s.x=-1./s.x;
        l = length(s);
        d += l/40.;

        if (l >14.0 &&float(t)  >2.)
            return vec3(-sin(d +1.),-sin(d +1.8),-sin(d+3.));
         ;  // return vec3(0.);
    }
    return vec3(.0);
    }
 vec3 ox(vec2 p,vec2 t) {
    p*=1.25;
       vec2 s = p;
       float d = 0.0, l;
         float flip=-t.x;
         if (flip<0.) p = -p;
         if( (p.x+.25)*(p.x+.25)+p.y*p.y<1.||(p.x>0.&& p.x*p.x+p.y*p.y<7. ))
       for (int t = 0; t < 30; t++) {
         s = vec2(((s.x * s.x - s.y * s.y) -flip* p.x), (3.0* s.x * s.y - flip*p.y));
         if(flip<1.) s.x = 1./pow(s.x,flip)*sign(-s.x*flip);
         else s.x=-1./s.x;
           l = length(s);
         d += l/10.;
         if (l >14.0 )
             if (float(t)  >2.)
                 return vec3(-sin(d +time*1./gr*2.),-sin(d +time*gr*2.),-sin(d *time*2.));
                           // return vec3(0.);
       }
       return vec3(.0);
     }



const float brideSize = 12.;


        vec3 bride(vec2 p,vec2 t){
                   float c=0.,k=0.,l=0.,x=0.,e=0.;
  if(abs(p.y*p.y)+abs(p.x*p.x)<49.){
    p+= vec2(.77777,0.);
               //vv body vv
                   vec2 g=p/2.;
                  // g.x+=.5;
                   vec2 z=g;
                   for (int f=0;f<70;f+=1)if(abs(z.x+z.y)>20.&&f>4){x+=z.y;break;}
                   else {z=2.*vec2(-1./((z.x*z.x-1.44*z.y*z.y)-g.x*1.2+t.x),(1.2*z.x*z.y-1.2*g.y+t.y));
                         z.x=pow(abs(z.x),.777-t.x/49.);}
               //vv legs vv
                   g=p/4.;
                   //g.x-=.5;
                   z=g;
                   for (int f=0;f<70;f+=1)if(abs(z.x+z.y)>200.&&f>4){c=1.;break;}
                   else {z=3.*vec2(-1./((z.x*z.x-z.y*z.y)-g.x+t.x/40.),(77.0*z.x*z.y-2.*g.y+t.y/40.));
                         z.y = -1./z.y;}
               //vv head vv
                   g=p;
                   z=g;
                   for (int f=0;f<10;f+=1)if(abs(z.x+abs(z.y))>27.&&f>4){l=1.;break;}
                   else{z=vec2(-1./((z.x*z.x-z.y*z.y)-g.x+t.x/8.),(2.0*z.x*z.y-g.y+t.y/8.));
                        z*=pow(z.x,z.x);}
                   /*
               //vv mandelbrot\heart vv
                   g=p*2.;
                   g.x-=6.;
                   z=g;
                   for (int f=0;f<50;f+=1)if(abs(z.x+z.y)>20.)break;
                   else {z=vec2(((z.x*z.x-z.y*z.y)-g.x-t.x/4.),(2.0*z.x*z.y-g.y-t.y/4.));
                                if(f>2)k+=0.02;}*/
               //vv eye lights vv
                   g=p;
                   z=g;
                   for (int f=0;f<4;f+=1)if(abs(z.x+z.y)>20.)break;
                   else {z=vec2((1./(z.x*z.x-z.y*z.y)-g.x-t.x/4.),(4.0*z.x*z.y-g.y-t.y/4.));
                         if(f>2)e+=0.3;}
}

  return vec3(l+c,l+x+c,l+c)*10000.+clamp(vec3(0.,(k+e)*10.,(k+e)*10.),0.,1.);}


  vec3 dress(vec2 p,vec2 t){
  p/=2.5;

   p.x*=1.77;
       p.x-=.3;

   p.y*=-1.;
   vec2 z=p;
   float l = 0.;
  const float iterations =  71.;
       for (float f=0.;f<iterations;f+=1.){

               //if(length(z)>c)z/=c;//this refracts the Mandelbrot outwards

           z=2.*vec2(-1./(z.x*z.x-z.y*z.y-p.x+t.x), 2.0*z.x*z.y-p.y+t.y);//this is {s=s^2-p;s.real=-1./s.real}
   z.x=sqrt(abs(z.x));
   if ((p.x-1.)*(p.x-1.)+p.y*p.y*3.<1.5)l=z.x;
  }

   return vec3(l);}
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
                                                                                      
              vec3 tokogae (vec2 p, vec2 t){
                  vec2 s = p*2.;
                   float l=1.;
                  vec3 digorno;

                   for (int f=0;f<41;f+=1)if(abs(s.y)<5.){s=vec2(s.x+s.y/(s.x*s.x + s.y*s.y), (1./(s.x*s.x + s.y*s.y))-sin(1.-t.x)/2.);//this equation comes from the equation (x-1/((x - y*i)))=x


                  s.y=s.y-log(dot(s.y,s.y))*-sin((1.-t.x)/2.);
                  digorno+=vec3(s.x,s.x/s.y,(s.y/s.x));
                  }
                  else         digorno-=vec3(s.x*1.4,(s.y*s.x),s.y)/50.;

                  return digorno/4.;
              }


      vec3 TOLTOK (vec2 p, vec2 t){
                                  float precores = 0.49;
                                  if(spirated!=0.) precores = 1.;
                                  if(spirated>-.5) p.y*=-1.;
                                  float cored = log(zoom*3./2.)/log(.5)+1.+precores;
                                  float c = length(p);
                                  float loops=1.;
                                                    vec2 s = p*1.5;
                                  if(!MetaCored)for(int i=1;i<60; i++)if(c<2./3.&&loops<cored){s*=2.;c*=2.;loops++;}else break;
                                  loops=0.;
                                  float hyperCore=0.;
                                  float lfc = length(freed(coords));
                                  if(outerCoresOff) hyperCore=0.;
                                  else if(!MetaCored)hyperCore=cored*2./3.+log(lfc*3./2.)*0.9551195-1.;//.9551195 is based on x=log3(x), x = .910239log3(x).  So (1.-.910239)/2+.910239=.9551195 may be incorrect but is close to right.
                                   // if(MetaCored&&morph>=.5)hyperCore*=4./3.;//engage overstable core if dancing

                                  float term=0.;
                                  if(spirated!=0.)term=(1.-lfc)*(3.-2.7182818);//if is spirated then oscillate the function's log between e and 3

                   float l=1.;
                  vec3 digorno=vec3(0.);
                   for (int f=0;f<41;f+=1)if(abs(s.y)<5.){
                                      if(spirated!=0.&&length(s)<2./3.)   s*=length(s)*6.28/(atan(s.y,s.x)+3.14159);

                       if(f>0) s=vec2(s.x+s.y/(s.x*s.x + s.y*s.y), (1./(s.x*s.x + s.y*s.y))+zoom*1.5-1.);//this equation comes from the equation (x-1/((x - y*i)))=x.  This equation has no solutions, but upon feedback it gains solutions (technically this may require other steps too)
                       for (int counter=0;counter<15;counter+=1)if(abs(s.y)<1.5*(1.-zoom*1.5)){
                            s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y-t.x, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y-t.y);//x**3
                            s.x=log(abs(s.x))/log(3.-term);


                            float d = length(s);
                            if(d<4./3.&&petals!=0.)s=spin2(s,atan(s.y,s.x)*petals/6.);
                            for(int i=0;i<69; i++)if(!MetaCored&&d<2./3.&& loops+float(f)<hyperCore)
                         {
                               float shift=2.;s*=shift;d*=shift;loops++;

                               float wise;
                               if(mod(float(i),4.)==0.)wise=1.;
                               else if(mod(float(i),4.)==1.)wise=-1.;
                               else  if(mod(float(i),4.)==2.)wise= -1.;
                               else  if(mod(float(i),4.)==3.)wise=1.;

                               if(metaCarousel!=0.)s=spin2(s,time*wise*metaCarousel*(1.+petals/6.)*rate);

                            }
                             else break;

                       }else break;


                  l = s.x-l;

                  //s.y=s.y-log(dot(s.y,s.y))*-sin((1.-zoom*1.5)/2.);
                  digorno+=vec3((s.y/s.x),(s.y/s.x)*5.+l*s.y,s.x);
                  }
                      else         digorno-=vec3(s.x*1.4,(s.y*s.x),s.y)/21.;

                  return digorno/8.;
              }


  vec3 TOLTOK1    (vec2 s, vec2 t){
                            s=-s.yx;
                            vec2 p = s;
    vec3 ret = vec3(1.);
      for (int f=0;f<20;f+=1)if(abs(s.y)<30.){
          if (f<10)
          for (int p=0;p<2;p+=1)if(abs(s.y)<(1.-t.x)*2.)
          {
          s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y);//x**3
              s.x=log(abs(s.x));
              ret+=vec3(s.y/100.-s.x*s.y/888.,s.x/8.-s.y/s.x/2000.,1.-s.x/20.)/20.;
             }
          if (f>3){ s=vec2((s.x+s.y/(s.x*s.x + s.y*s.y)), (1./(s.x*s.x + s.y*s.y)))-abs(p);
          s.y=s.y-log(dot(s.y,s.y))*-sin(1.-t.x);
          ret= vec3(s.y,abs(s.x-s.y),s.y*s.x)/50.;
                    }
      }
      return ret;
}



vec3 xx(vec2 s, vec2 t){
                                   vec2 m =vec2(0.);
                                   if(wheel) m =  s/length(freed(coords))+coords.yx;//this is essentially just p as in the mandelbrot x <== x^2+p

      for (int f=0;f<40;f+=1)if(abs(s.y)<19.){
          s=vec2((s.x*s.x-s.y*s.y)-t.x-m.x, 2.0*s.x*s.y-t.y-m.y);//this is {s^2}
  s.x=log(abs(s.x));
}

  return vec3(s.x,s.y,0.);}
vec3 xtol(vec2 s, vec2 t){
                                  float cored=   log(zoom*1.75)/log(.75)+1.;
                                        float h =1.3333333;
                                            float loops=1.;
                                        if(cored>1.&&MetaCored)
                                         {
                                             float c = sqrt(s.y*s.y+s.x*s.x);
                                             c/=h;
                                             {for(int i = 0; i<69+1; i++)if(c<h/2.&&loops<cored){s*=h;c*=h;loops++;}

                                                                                           }
                                         }

                            for (int f=0;f<40;f+=1)if(abs(s.y)<19.){
                            if(mod(float(f),3.)==0.)s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y);//x**3
                            s=vec2((s.x*s.x-s.y*s.y), 2.0*s.x*s.y);//this is {s^2-p;s.real=-1./s.real}
                                    s.x=log(abs(s.x));

                                    if(MetaCored){
                                        float c = sqrt(s.y*s.y+s.x*s.x);
                                        //for(int i=0;i<69; i++)if(c<2./3.&&i<int(cored)){p*=2.;c*=2.;}
                                        c/=h;
                                        if(c<h/2. &&f<int((cored/2.+log(length(freed(coords))*h/2.)+.5)/2.)){float shift=h;s*=shift;c*=shift;}
                                                                 }
                                                                                      }

                           return vec3(s.y/50.-s.x*s.y/600.,s.x/8.-s.y/s.x/200.,1.-s.x/10.);

                        }

    vec3 acrostic(vec2 t){
      float c=1.44;

        for (int f=0;f<40;f+=1)if(abs(t.x)<1./sqrt(zoom)){
        //  if(length(t)>c)t/=c;

        t=vec2(1./(t.x*t.x-t.y*t.y), 2.0*t.x*t.y);//this is {s=s^2;s.real=-1./s.real}}
//t.x=log(abs(t.x)
    }
    return vec3(t.x,1./t.y,t.x/t.y);

}

                      vec3 sword(vec2 p,vec2 t){
                                 //sword
                                     vec2 g=p*3.;
                                     g.x+=-sin(time)*20.+12.;
                                     g.x/=1.5;
                                     vec2 z=g;
                                     float d = 0.0;
                                     float u=0.;
                                     vec3 h;
                                     if (p.x>.7&&g.x>-2.5 && abs(g.y*g.x) <1.77 &&abs(g.y)<2.11111111)for (int i = 0; i < 14; i++) {
                                           z = vec2(1.1/(1.-pow((z.x * z.x - z.y * z.y +1.+ g.x),2.)), -1.77/(2.0 * z.x * z.y + g.y));
                                         u = length(z);
                                         d +=z.x+z.y+20.;
                                         if (u >5.4 && ( i==4||( i==13 )))  h=vec3(-sin(-d*0.0061),-sin(-d * 0.0063),-sin(-d * 0.0069));
                                         
                                   }
                                 return h;
                                 }
                      
                                  vec3 flames (vec2 p){
                                      p.x = -p.x;
                                      p*=1.5;
                                      p.y*=3.;
                                  vec2 s=p;
                                  float l=0.;
                                          float m = 0.;
                                          float k = 0.;
                                          if(abs((p.x)*(p.x)+(p.y*p.y))<50.)
                                  for (int f=0;f<20;f+=1)if(abs(s.x+s.y)>20. && f>1)l=1.;
                                      else{ s=vec2(-1./(s.x*s.x+s.y*s.y+p.x),-(2.0*s.x/s.y+p.y));
                                          m += abs(s.x+s.y);
                                          }
                                      
                                  return vec3(m*l, m*l/400.,-sin(m*1.618)*l);}


                          vec3 scroll(vec2 p,    vec2 unleashed) {
                                   p=-p*2.;
                                   float flip=unleashed.x;
                                   if (flip<0.) p = -p;
                                   float r = 0.;

                              vec2 s = p;
                              float d = 0.0, l=0.;
                             if(length(p)<2.) for (int t = 0; t < 20; t++)if (l < 20.||t<4)
                              {
                                  s = vec2(((s.x * s.x - s.y * s.y) +flip* p.x*p.x), (2.0* s.x * s.y + flip*p.y*p.y));
                                  if(flip==-1.)s.x = -1./s.x;
                                  else s.x = pow(s.x,flip)*sign(s.x*flip);
                                  l = length(s);
                                  d += l/40.;
                              }
                              else { r=d ;return vec3(r);}
                              r=0.;
                              return vec3(r);
                          }
                                                                                      
                          
                          vec3 lamp(vec2 p,vec2 unleash) {
                            p.x-=3.;
                            p*=3.;
                            vec2 s = p;
                            float d = 0.0, l;
                              if (!(p.x<-4.)&&abs(p.y)<1.789||unleash.x!=-1.)
                            for (int i = 0; i < 5; i++) {
                              s = vec2(-1./(s.x * s.x - s.y * s.y + p.x),-1./( 2.0 * s.x * s.y + p.y));
                              l = length(s);
                             d +=s.x+s.y+20.;
                               
                              if (l >7.)  return vec3(1.-sin(d * 0.001),1.- sin(d * 0.0015),1.- sin(d * 0.0069));
                            }
                              
                            return vec3(0.0);
                                                                                      }


                                                                                      
                                                                                      
  vec3 body(vec2 p, vec2 t){return torso(p,t)+musculature(p,t)+robe(p,t)+legs(p,t/33.3);}
  vec3 bod(vec2 p, vec2 t){t*=zoom;return body(p,t)+heart(p,t);}
  vec3 manny(vec2 p, vec2 t){
    return +body(p,t)+face(p,0.*t)+shiny(p,t);}
  vec3 mannyX(vec2 p, vec2 t){return body(p,t)+excelsior(p,vec2(time*metronome,0.));}
  vec3 fourCreatures(vec2 p, vec2 t){
             float inversion = -1.;
            if (wheel)inversion=coz(time);
            vec2 spacing = vec2(5.,3.)*.7;
            p.x+=.5;

            return eaglePerched(p+spacing,vec2(inversion,0.))+bod(p+spacing,t)+
            lion(p+vec2(-spacing.x,spacing.y),vec2(inversion,0.))+bod(p+vec2(-spacing.x,spacing.y),t)+
            ox(p+vec2(spacing.x,-spacing.y),vec2(inversion,0.))+bod(p+vec2(spacing.x,-spacing.y),t)+
            man(p-spacing,vec2(inversion,0.))+bod(p-spacing,t)  ;
}
            vec3 fourCreaturesSmall(vec2 p, vec2 t){
                    float inversion = -1.;
                   if (wheel)inversion=coz(time);
                      vec2 spacing = vec2(resolution.y/min(resolution.x,resolution.y),resolution.x/min(resolution.x,resolution.y))*2.24;
                     // spacing.x+=resolution.x/min(resolution.x,resolution.y)*.15;
                      return eaglePerched(p+spacing,vec2(inversion,0.))+body((p+spacing)*3.,t)+
                      lion( spin2(p+vec2(-spacing.x,spacing.y),-sin(time)/4.),vec2(inversion,0.))+body((p+vec2(-spacing.x,spacing.y))*3.,t)+
                      ox(p+vec2(spacing.x,-spacing.y),vec2(inversion,0.))+body((p+vec2(spacing.x,-spacing.y))*3.,t)+
                      man(p-spacing,vec2(inversion,0.))+body((p-spacing)*3.,t)  ;
          }

  //function library: manny body legs robe musculature torso face excelsior shiny lion ox man eagle eaglePerched fourCreatures heart anomalyze spin x

  //function library: manny body legs robe musculature torso face excelsior shiny lion ox man eagle eaglePerched fourCreatures heart anomalyze spin
void main(){
vec2 p=-((vUv.yx)-.5)/(resolution.xy/max(resolution.x,resolution.y))*shaderScale/2.;


spunC=coords.yx;

if(carousel!=0.){spunC*=-1.;spunC=spin2(spunC,-carousel*mod(time*rate,PI*2.));}
vec2 backGround=freed(p*zoom+spunC);
if(carousel!=0.)backGround=spin2(backGround,carousel*mod(time*rate,PI*2.));

                   backGround=spin2(backGround,atan(backGround.y,backGround.x)*petals/6.);
                   //p.x+=.5;


vec2 dance = vec2(0.);
                                   vec2 dance2 = vec2(0.);

if (morph>.5 && colorCombo>=10)  dance=vec2(-sin(time+time2dance),
                                        -sin((time+time2dance)*-1.618))*zoom+(spunC.yx+.5)*log(pow(zoom,1.618))/log(1.618)*zoom*.5;//a lot of these coords should probably be spunC

else if (morph>.5&&(colorCombo<10||colorCombo==14)){float lfc=length(freed(coords));
                                   dance2 = vec2(
                                           -abs(lfc/(lfc-zoom)) -lfc/(lfc+zoom)*2./3.,
                                     -((zoom*lfc)/(lfc+zoom)*sign(coords.y)*sign(coords.x)*(1.-lfc*zoom) )
                                       )
                                       ;}

 vec2 driftCanceller=vec2(dance.x,-dance.y);
                                                                                         
                                                                                         
                                                                                         
                                                 vec3 zoomer;
                                                 vec2 t =vec2(-sin(time),-sin(time*.618));

     if(colorCombo<10)zoomer=tol(backGround, dance2);
     else if (colorCombo==11||colorCombo==18)zoomer=heartZoom(backGround+driftCanceller, dance);
     else if (colorCombo==13)zoomer=tokogae(backGround,vec2(zoom));
     else if (colorCombo==14)zoomer=TOLTOK(backGround,dance2);
     else if (colorCombo==15)zoomer=xx(backGround,dance2);
     else if (colorCombo==16)zoomer=xtol(backGround,vec2(0.));
     else if (colorCombo==17)zoomer=body(backGround,vec2(-sin(time*20.)/50.,-sin(time*gr*20.)/30.)*zoom)+robe(backGround,vec2(0.))/2.+faceHeights(backGround,t*zoom)+                                                   heartZoom(backGround-vec2(.5,0.)+driftCanceller,dance);
    else if (colorCombo==19)zoomer=acrostic(backGround);

                                                 
                                                 
                                                 
                                                 
                                                 
         
         vec2 characterP = p*2.;
         vec2 fourcreaturePlayerP = p*1.5;

         vec2 move = -d.yx*volume;
         vec2 moveDynamic = (move/2.+t/4.)/2.;
     vec3 creatures,b;
     vec3 bridge=vec3(0.);
                                          
    vec3 cloud= vec3(0.);
                                                 float swordSkew = 0.;
                                                 
                                                 if(helm)
                                                 {bridge=fourCreaturesSmall(characterP,moveDynamic);
                                                     cloud=clamp(clouds(characterP,moveDynamic),0.,1.);
                                                     }
     if(fourCreats<0){creatures=fourCreatures(backGround*8.,moveDynamic/4.);
         
        if(length(backGround*brideSize)>4./3./brideSize)
         
         b=bride(backGround*brideSize,10.*zoom*vec2(-sin(time2dance*gr),-sin(time2dance)))+heart(backGround*brideSize/1.5-vec2(.25,0.)+driftCanceller,dance);
         
     }
                            
                                                 float inversion = -1.;
                                                 if (wheel)inversion=coz(time);

                       vec3 mny=vec3(0.);
if(colorCombo!=17){
               if(metronome>1.) mny = mannyX(characterP,moveDynamic);
               else if (Character==0)mny=manny(characterP, moveDynamic);
               else if (Character==1){mny = MannyWoManny(characterP,
                                                    vec2(time2dance,time2dance*gr)
                                                    )+robeL(characterP,vec2(time2dance,time2dance*gr)
                                                            )*.95;}
               else if (Character==2){
                   mny=bride(characterP*2.,moveDynamic/2.)+dress(characterP*3./2.,moveDynamic*2./3.)*2.;
                   swordSkew+=.5;}
               else if (Character==3)mny=lion(fourcreaturePlayerP,vec2(inversion,0.))+body(characterP,moveDynamic);
               else if (Character==4){
                   mny=eaglePerched(fourcreaturePlayerP,vec2(inversion,0.))+body(characterP,moveDynamic);
                   swordSkew+=1.;}
               else if (Character==5)mny=ox(fourcreaturePlayerP,vec2(inversion,0.))+body(characterP,moveDynamic);
               else if (Character==6)mny=man(fourcreaturePlayerP,vec2(inversion,0.))+body(characterP,moveDynamic);

}
vec3 ARTICLES=vec3(0.);
    if(articles){
            ARTICLES += sword(characterP+vec2(swordSkew,0.),vec2(0.));
            ARTICLES+=scroll(characterP+1.5*vec2(0.,resolution.x/min(resolution.x,resolution.y)),vec2(-1.));
            vec3 SWORD = sword(characterP+vec2(swordSkew,0.),vec2(0.));;
            ARTICLES+=clamp(lamp(characterP,vec2(-1.))-(SWORD.r+SWORD.g+SWORD.b)*1000000.,0.,1.);
    }
                                                 mny=clamp(mny,0.,1.);
vec4 starship = texture2D(STAR,vUv);
float isBlack =1.;
if (starship.x+starship.y+starship.z==0.&&starship.w!=0.)isBlack=0.;
else if(starship.x==starship.y&&starship.x==starship.z&&abs(starship.z-.5)<.1&&starship.w!=0.) isBlack=.5;
gl_FragColor=vec4((clamp(mny+starship.xyz-(ARTICLES.r+ARTICLES.g+ARTICLES.b),0.,1.)+ARTICLES+creatures+b+bridge+
              clamp(clamp(cloud+
                                zoomer+2.*heart(p,-move)
                          -(starship.x+starship.y+starship.z)*(starship.w*starship.w)
                          -(creatures.r+creatures.g+creatures.b+b.b+b.g+b.r)*1000.
                                                        ,0.,1.)-(mny.r+mny.b+mny.g)*10000.,.0,1.))*isBlack
      ,1.
              );}
                                                 
 /*
  gl_FragColor=vec4(mny+creatures+b+bridge+heart((p+vec2(.5,0.))/2.,move)+
                    clamp((zoomer)-(m.r+m.b+m.g+creatures.r+creatures.g+creatures.b+b.b+b.g+b.r)*100.,.0,1.)
            ,1.);}
  
  */
</script>

    </body>
</html>
