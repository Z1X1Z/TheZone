<?php header('Cache-Control: max-age=31536000');header('Cache-Control: private'); ?>
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Zone:X - Sonic Starship</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link type="text/css" rel="stylesheet" href="main.css">
            <script id="threeJSscript" src = "https://cdnjs.cloudflare.com/ajax/libs/three.js/r127/three.min.js"></script>
            <script id="wadJSscript" src = "https://unpkg.com/web-audio-daw"></script>
            
    </head>
    <body>
        <div id="allText">
            <div id="HK"></div>
            <div id="textWindow"></div>
        </div>
        <script src="OFFLINEonlineSwitch.js"></script>
        
        <!--
         https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_text_create
        -->
        <script>
        function hk() {
          var x = document.createElement("INPUT");
          x.setAttribute("type", "text");
          x.setAttribute("id", "hotkeys");
          x.setAttribute("placeholder", "Hotkeys!");
          x.setAttribute("oninput", "getKey()");
          document.getElementById("HK").appendChild(x);
        }
      if(navigator.userAgent.toLowerCase().match(/mobile/i)||navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)
            hk();
      
        let androidGetKey="";
        let androidGetKeyLast="";

        function getKey(){
            androidGetKeyLast = androidGetKey;
            androidGetKey = document.getElementById("hotkeys").value;
         let scan=androidGetKey.length-1;
         if(androidGetKey.length-1==androidGetKeyLast.length) while(androidGetKey[scan]==androidGetKeyLast[scan]&&scan>=0){
                window.key=androidGetKey[scan];
                scan--;
                }
         }
    </script>


    <div id="container"></div>

        <script id="vertexShader" type="x-shader/x-vertex">

                varying vec2 vUv;
                uniform vec2 coords;
                   uniform vec2 resolution;
                   uniform float time;

            void main()    {

                vUv = uv;
                gl_Position = vec4( position, 1.0 );
            }
        </script>

        <script id="fragmentShader" type="x-shader/x-fragment">

            varying vec2 vUv;
            uniform vec2 coords;
               uniform vec2 resolution;
            uniform int colorCombo;
            uniform float time;
            uniform float zoom;
            uniform float metronome;

            uniform float time2dance;
            uniform int fourCreats;

            uniform bool free;
            uniform bool MetaCored;
            uniform float morph;

            float zin(float x){return -sin(x);}
            float coz(float x){return -cos(x);}
                      const float gr=-cos(216.)/-cos(612.)-1.;
        vec2 freed(vec2 p){
            if(free){
                float shift = 3.;
                p+=shift/2.;
                p=(mod(abs(p),shift));
                p-=shift/2.;
            }
            return p;
            }
                      vec3 bride(vec2 p,vec2 t){
                                 float time2 = t.x;
                                 float c=0.,k=0.,l=0.,x=0.,e=0.;
                if(abs(p.y*p.y)+abs(p.x*p.x)<49.){

                             //vv body vv
                                 vec2 g=p/2.;
                                // g.x+=.5;
                                 vec2 z=g;
                                 for (int f=0;f<30;f+=1)if(abs(z.x+z.y)>20.&&f>4)x+=z.y;
                                 else {z=2.*vec2(-1./((z.x*z.x-1.44*z.y*z.y)-g.x*1.2-sin(time2*gr)/40.),(1.2*z.x*z.y-1.2*g.y-sin(time2/2.)/40.));
                                       z.x=pow(abs(z.x),.777-sin(time2)/49.);}
                             //vv legs vv
                                 g=p/4.;
                                 //g.x-=.5;
                                 z=g;
                                 for (int f=0;f<70;f+=1)if(abs(z.x+z.y)>200.&&f>4)c=1.;
                                 else {z=3.*vec2(-1./((z.x*z.x-z.y*z.y)-g.x),(77.0*z.x*z.y-2.*g.y-sin(time2/2.)/7.));
                                       z.y = -1./z.y;}
                             //vv head vv
                                 g=p;
                                 z=g;
                                 for (int f=0;f<10;f+=1)if(abs(z.x+abs(z.y))>27.&&f>4)l=1.;
                                 else{z=vec2(-1./((z.x*z.x-z.y*z.y)-g.x),(2.0*z.x*z.y-g.y-sin(time2*4.)/8.));
                                      z*=pow(z.x,z.x);}
                             //vv mandelbrot\heart vv
                                 g=p*2.;
                                 g.x-=6.;
                                 z=g;
                                 for (int f=0;f<50;f+=1)if(abs(z.x+z.y)>20.)break;
                                 else {z=vec2(((z.x*z.x-z.y*z.y)-g.x-sin(time2*gr)/4.),(2.0*z.x*z.y-g.y-sin(time2/2.)/4.));
                                              if(f>2)k+=0.02;}
                             //vv eye lights vv
                                 g=p;
                                 z=g;
                                 for (int f=0;f<4;f+=1)if(abs(z.x+z.y)>20.)break;
                                 else {z=vec2((1./(z.x*z.x-z.y*z.y)-g.x-sin(time2*gr)/4.),(4.0*z.x*z.y-g.y-sin(time2*2.)/4.));
                                       if(f>2)e+=0.3;}
        }
                             return vec3(l+c,l+x+c,l+c)*10000.+clamp(vec3(0.,(k+e)*10.,(k+e)*10.),0.,1.);}
           vec3 bride2manny(vec2 p,vec2 t){
                                                
                                        float time2 = t.x;
                                        float c=0.,k=0.,l=0.,x=0.,e=0.;
                                        vec3 head;
                       if(abs(p.y*p.y)+abs(p.x*p.x)<700.){
                           t.y=t.x;
                                    //vv body vv
                                        vec2 g=p/2.;
                                         ///g.x+=(coz(t.y)-1.)/2.*.5;
                                        vec2 z=g;
                                        if(abs(p.y)<6.)for (int f=0;f<30;f+=1)if(abs(z.x+z.y)>(20.-(coz(t.y)-1.)/2.*50.)&&f>4)x+=z.y/20000000.;
                                        else {z=2.*vec2(-1./((z.x*z.x-(1.44+(coz(t.y)-1.)/2.*.44)*z.y*z.y)
                                     -g.x*(1.2+(coz(t.y)-1.)/2.*.2)),
                                ((1.2-(coz(t.y)-1.)/2.*.8)*z.x*z.y-(1.2+(coz(t.y)-1.)/2.*.2)*g.y-sin(t.x/2.)/20.));
           //The Holy Bible Revelation 21:16 "The city was laid out like a square, as long as it was wide.
           //He measured the city with the rod and found it to be 12,000 stadia in length,
            //and as wide and high as it is long. The angel measured the wall using human measurement, and it was 144 cubits thick.
                                                                  z.x=pow(abs(z.x),(.777+(coz(t.y)-1.)/2.*.277));}



                   //legs
                                        g=p/4.;
                                       // g.x-=.5;
                                        z=g;
                                        if(g.x>.75&&g.x<1.7&&abs(g.y*g.x)<.54)for(int f=0;f<8;f+=1)if(abs(z.x)>52.&&f>1)c=abs(z.x)/1000000.;
                                        else {z=3.*vec2(-1./((z.x*z.x-z.y*z.y)-g.x),(77.0*z.x*z.y-(2.+(coz(t.y)-1.)/2.)*g.y-sin(t.y*2.)/7.));
                                              z.y = -1./z.y;}
                          //vv head vv
                                                g=p;
                                                z=g;
                                   if(abs(p.y)<4.)for (int f=0;f<21;f+=1)if(abs(z.y)>19.&&(f==int(floor(.8-(coz(t.y)-1.)/2.*.4)))){l=0.;break;}
                                        else if(abs(z.y)>19.&&(f>4))l=1.;
                                                else{z=vec2(-1./((z.x*z.x-z.y*z.y)-g.x),2.0*z.x*z.y-g.y);
                                     z*=pow(z.x,(z.x-(coz(t.y)-1.)/2.*-z.x));
                                     l = clamp(1.-abs(z.y)*6.,0.,1.);
                                     if(z.x>-.1&&f!=0)l=clamp(1.-z.x*49.,0.,1.);
                                        }

                                    //vv mandelbrot\heart vv
                                                         g=p*(2.+(coz(t.y)-1.)/2.*1.);
                                                         g.x-=6.+(coz(t.y)-1.)/2.*5.5;
                                        z=g;
                                        for (int f=0;f<50;f+=1)if(abs(z.x+z.y)>20.)break;
                                        else {z=vec2(((z.x*z.x-z.y*z.y)-g.x-sin(time2*gr)/4.),(2.0*z.x*z.y-g.y-sin(time2/2.)/4.));
                                                     if(f>2)k+=0.005;}
                              
               }
                                    return vec3(l)+vec3(c,x+c/2.,0.)*10000.+clamp(vec3(0.,(k+e)*10.,(k+e)*10.),0.,1.);}
                                                                                                                                        

        vec3 robeL(vec2 g, vec2 t){
              float r=0.;
              g.x*=(1.2+(coz(t.y)-1.)/2.*.2);
              g.x+=(-.45-(coz(t.y)-1.)/2.*.5);
              g.y/=1.14;
              vec2 z=g.xy;
              if(g.x>.5 &&abs(g.y)<(.8-(coz(t.y)-1.)/2.*1.0))for(int f=0;f<70;f+=1)if(abs(z.y)>11.&&f>7)r=clamp(1.4-abs(g.x-2.3)
                               *(1.-abs(g.y*g.x))-.07//(un)comment this line to toggle sleeves
                              ,0.,1.);
              else{
                  z=1.1*vec2(-2./(((1.2+(coz(t.y)-1.)/2.*.1)*z.x*z.x-1.8*z.y*z.y)-g.x),(3.*z.x*z.y-(1.4+(coz(t.y)-1.)/2.*.1)*g.y));;
                  z.x=pow(abs(z.x),.8);}
              return vec3(r);
              }

          vec3 heart(vec2 g, vec2 t){
              //Mandelbrot\heart
                  g.x-=.5;
                  g.y*=-1.;
                  vec2 z=g;
                  vec3 h=vec3(0.);
                  const int cycles = 60;
                  for (int f=0;f<cycles;f+=1)if(abs(z.y)>10.)h=vec3(0.);
                        else {z=vec2(((z.x*z.x-z.y*z.y)-g.x+t.x),(2.0*z.x*z.y-g.y+t.y*4.));//mandelbrot loop factored into real and imaginary components from z<=z^2-g
                            h+=(vec3(z.x*z.y,z.x,z.y)+.3)*2./float(cycles);}
          return h;
          }
              vec3 heartZoom(vec2 p, vec2 t){
                  //p.x+=.5;
                  //p+=coords.yx;
                  p.y=-p.y;

                  vec2 z=p;
                  vec3 h=vec3(0.);
                  const int cycles = 300;
                  for (int f=0;f<cycles;f+=1)if(abs(z.y)>10.)h=vec3(0.);
                  else {z=vec2(((z.x*z.x-z.y*z.y)-p.x+t.x),(2.0*z.x*z.y-p.y+t.y));//mandelbrot loop factored into real and imaginary components from z<=z^2-g
                      h+=(vec3(z.x*z.y,z.x,z.y-.2*(1.-p.x))+.3)*2./float(cycles);}
          return h;
          }
              vec3 face(vec2 g, vec2 t){
              float l = 1.;
              g*=2.;
              vec2 z=g.xy;
              if(g.x*g.x+g.y*g.y<40.)for (int f=0;f<21;f+=1)if(abs(z.y)>19.&&(f==1||f>3)){
                  if (f==1){l=1.;break;}
                  l=1.-length(z)/40.;//clouds and face
                  break;}
              else{
                  z=vec2(-1./(z.x*z.x-z.y*z.y-g.x),2.0*z.x*z.y-g.y);
                  l=abs(z.y)*5.;//smooths middle horn, removes some clouds
                  if(z.x>-.1)l=z.x*50.;}//face with closed small holes
              return vec3(clamp(1.-l,0.,1.));
              }
          vec3 faceHeights(vec2 g, vec2 t){
          float l = 1.;
          g*=2.;
          vec2 z=g.xy;
          if(g.x*g.x+g.y*g.y<40.)for (int f=0;f<21+6*5;f+=1)if(abs(z.y)>19.&&(f==1||f>3)){
              if (f==1){l=1.;break;}
              l=1.-length(z)/40.;//clouds and face
              break;}
          else{
              z=vec2(-1./(z.x*z.x-z.y*z.y-g.x+t.x),2.0*z.x*z.y-g.y+t.y);
              l=abs(z.y)*5.;//smooths middle horn, removes some clouds
              if(z.x>-.1)l=z.x*50.;}//face with closed small holes
          return vec3(clamp(1.-l,0.,1.));
          }
         vec3 shiny(vec2 p,vec2 t){
            p*=2.;
             vec2 s = p;
             float l=0., d = 0., negator = 1.;
                 for (int f=0;f<21;f+=1)
                 if(abs(s.y)>21.&&(f==1||f>2)){
                     l=1.-length(s)/40.;
                     if (f == 1)
                             negator=0.;
                     else
                             d+=length(s)/10.;
                     break;
                 }
                 else{
                     s=vec2(-1./(s.x*s.x-s.y*s.y-p.x), 2.0*s.x*s.y-p.y);
                     l=abs(s.y)*3.5;//refines middle horn, optional
                     if(s.x>-.1)l=s.x*50.;//closes small holes
                     d+=length(s)/10.;
                 }
                 if (l>.54) negator = 0.;
                 return vec3(-sin(d +t.x*3.+6.28318/3.),-sin(d+t.x*3.+6.28318*5./3.),-sin(d+t.x*3.))*5.*negator;
         }
                            vec3 excelsior(vec2 p,vec2 t){
                                                t.x*=-1.;
                                                 p*=2.;
                                                 vec2 s=p;
                                                 vec3 l=vec3(.1,.5,1.1);
                                                     for (int f=0;f<21;f+=1)
                                                 if(abs(s.y)<21.){
                                                  s=vec2(((s.x*s.x-s.y*s.y)-p.x),(2.0*s.x*s.y-p.y));

                                                     s.x=pow(s.x,-sin(t.x*2.+3.14))*sign(-s.x*-sin(-t.x*2.+3.14));
                                                                      l=vec3(2.-abs(s.y*-sin(-t.x))*19.)*-sin(-t.x);//middle horn
                                                     if(s.x>-.1)l=vec3(-sin(t.x)-(s.x*(100.-100.*-sin(t.x*2.-3.14))*-sin(t.x)));
                                                     }
                                             return vec3(1./l);
                                     }

           vec3 man(vec2 p,vec2 t) {
               p*=-2.;
               vec2 s = p;
               float d = 1.0, l;
               float flip=-t.x;
               if (flip<0.) p = -p;
               if (abs(p.x*p.x+p.y*p.y)<2.0)for (int t = 0; t < 30; t++) {
                       s = vec2(((s.x * s.x - s.y * s.y) +flip* p.x), (s.x * s.y + flip*p.y));
                       s.x = 1./pow(s.x,flip)*sign(s.x*flip);
                 l = length(s);
                 d += l/25.;
                   if (l >20.0&&t!=0)return vec3(-1.);}

                  if (abs(p.x*p.x+p.y*p.y)<2.0)return vec3(1.);
                  else return vec3(0.0);
           }


           vec3 eagle(vec2 p,vec2 t) {
           p*=10.;
               vec2 s = p;
               float d = 0.0, l;
               float flip=-t.x;
               if (flip<0.) p = -p;
               if(abs(6.*p.x*p.x+p.y*p.y*2.)<700.0)
               for (int i = 0; i < 30; i++) {
                   s=vec2(-(s.x * s.x - s.y * s.y) +flip* p.x, (s.x * s.y + t.y*p.y));
                  /* if(b<=.5 ||rate == 0.)
                       s.x = 1./s.x;
                   else*/
                   s.x = 1./pow(s.x,flip)*sign(s.x*flip);
                     s.y = s.x*s.y;
                   l = length(s);
                   d +=2.;
                   if (l >(20.0) ) if( float(i)>3.&&float(i)>3.)
                       return vec3(1.-sin(d * 0.003)-.5,1.- sin(d * 0.9)-.5,1.- sin(d * 0.1)-.5)*3.;}
               return vec3(.0);
              }

            vec3 eaglePerched(vec2 p, vec2 t){
                  p*=3.;
                  vec2 s=p;
                          float l = 0.;
                          if(abs((p.x)*(p.x)+(p.y*p.y))<8.&&p.x<0.1)
                  for (int f=0;f<20;f+=1)if(abs(s.x+s.y)>20.)l=1.;
                  else {s=vec2(1./(s.x*s.x+s.y*s.y+p.x),-(2.0*s.x*s.y-p.y));
                        l=-1.;}
                  return vec3(l);
              }

           vec3 lion(vec2 p,vec2 t) {
               p*=-3.;
             vec2 s = -p;

          float d = 0.0, l;

          float flip=t.x;
          if (flip<0.) p = -p;
          if(p.x*p.x*1.+p.y*p.y*2.<21.)
          for (int t = 0; t < 30; t++) {
              s = vec2(((s.x * s.x - s.y * s.y) +flip* p.x), (2.0* s.x * s.y + flip*p.y));
              s/=2.;
              s.x = pow(s.x,flip)*sign(s.x*flip);
              l = length(s);
              d += l/40.;

              if (l >14.0 &&float(t)  >2.)
                  return vec3(-sin(d +1.),-sin(d +1.8),-sin(d+3.));
               ;  // return vec3(0.);
          }
          return vec3(.0);
          }
       vec3 ox(vec2 p,vec2 t) {
          p*=-2.;
             vec2 s = p;
             float d = 0.0, l;
               float flip=t.x;
               if (flip<0.) p = -p;
               if( (p.x+.25)*(p.x+.25)+p.y*p.y<1.||(p.x>0.&& p.x*p.x+p.y*p.y<7. ))
             for (int t = 0; t < 30; t++) {
               s = vec2(((s.x * s.x - s.y * s.y) +flip* p.x), (3.0* s.x * s.y + flip*p.y));
                 s.x = pow(s.x,flip)*sign(s.x*flip);
                 l = length(s);
               d += l/10.;
               if (l >14.0 )
                   if (float(t)  >2.)
                       return vec3(-sin(d +time*1./gr*2.),-sin(d +time*gr*2.),-sin(d *time*2.));
                                 // return vec3(0.);
             }
             return vec3(.0);
           }

          vec3 torso(vec2 g, vec2 t){
          float b = 0.;
          vec2 z=g.xy;
          if(g.x*g.x+g.y*g.y<40.)if (g.x>0.)for(int f=0;f<12;f+=1)if(abs(z.y)>52.&&f>4)b=abs(z.y)/77.;
          else{
              z=2.*vec2(-1./(z.x*z.x-z.y*z.y-g.x),(2.0*z.x*z.y-g.y+t.y));
              z.x=sqrt(abs(z.x));}
          return vec3(b,b/2.5,0.);
          }
          vec3 musculature(vec2 g, vec2 t){
          float m=0.;
          g.x+=.54;
          vec2 z=g.xy;
          if(g.x>1.25&&abs(g.y)<2.5)for(int f=0;f<15;f+=1)if(abs(z.y)>15.&&f>7&&f!=15)m=abs(z.y)/25.;
          else {
              z=1.3*vec2(-1.5/((z.x*z.x-2.*z.y*z.y)-g.x),(1.9*z.x*z.y-1.87*g.y+t.y/4.));
              z.x=pow(abs(z.x),.57);}
          return vec3(m,m,m/2.);
          }
          vec3 robe(vec2 g, vec2 t){
          float r=0.;
          g.x+=.05;
          g.y/=1.14;
          vec2 z=g.xy;
          if(g.x>.5 &&abs(g.y)<1.)for(int f=0;f<70;f+=1)if(abs(z.y)>11.&&f>7)r=clamp(1.4-abs(g.x-2.3)
                           //*(1.-abs(g.y*g.x))-.07//(un)comment this line to toggle sleeves
                          ,0.,1.);
          else{
              z=1.1*vec2(-2./((z.x*z.x-1.8*z.y*z.y)-g.x),(3.*z.x*z.y-1.3*g.y+t.y));;
              z.x=pow(abs(z.x),.8);}
          return vec3(r);
          }
          vec3 legs(vec2 g, vec2 t){
          float b=0.;
          g/=2.;
          vec2 z=g.xy;
          if(g.x>.75&&g.x<1.7&&abs(g.y*g.x)<.54)for(int f=0;f<8;f+=1)if(abs(z.x)>52.&&f>1)b=abs(z.x)/70.;
          else{
              z=3.*vec2(-1./(z.x*z.x-z.y*z.y-g.x),77.*z.x*z.y-g.y+t.y);
              z.y=-1./z.y;}
          return vec3(b/2.,b,b/2.);
          }

                        
        
        vec3 tol(vec2 p, vec2 t){
            float cored = log(zoom*3./2.)/log(.5)+1.;
            float c = length(p);
            float loops=1.;
            if(MetaCored)for(int i=1;i<60; i++)if(c<2./3.&&float(loops)<cored){p*=2.;c*=2.;loops++;}else break;
            vec2 s=p;
            loops=0.;
                                                
            float hyperCore= (cored*2./3.+
                               log(length(freed(coords)))
                               -1.);
            for (float counter=0.;counter<41.;counter++)if(abs(s.y)<47.){
              
              
              s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y-t.x, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y-t.y);//x**3
              s.x=log(abs(s.x));
              
                if(MetaCored){
                    float d = length(s);

                    for(int i=0;i<69; i++)if(d<2./3.&& loops+counter<hyperCore)
             {float shift=2.;s*=shift;d*=shift;loops++;}
                    
                        else break;
                }
            }

                                             
            vec3 o=vec3(s.y);
            if(colorCombo==1) o=vec3(s.y,s.x/10.,1.-s.x/12.);
            else if(colorCombo==2) o=vec3(s.y/100.,s.x/8.-s.y/s.x/7000.,1.-s.x/16.)/1.2;
            else if(colorCombo==3) o=vec3(s.y/100.-s.x*s.y/888.,s.x/8.-s.y/s.x/2000.,1.-s.x/20.);
            else if(colorCombo==4) o= vec3(1.-s.x/20.,s.x/8.-s.y/s.x/2000.,s.y/35.-s.x*s.y/888.);
            else if(colorCombo==5)  o=vec3(s.y/40.-s.x*s.y/888.,1.-s.x/21.,s.x/6.-s.y/s.x/2000.);
            else if(colorCombo==6)o= vec3(s.x/8.-s.y/s.x/7000.,1.-s.x/16.,s.y/100.)/1.1;
                                          else if(colorCombo==7) return vec3(-sin(time*1.)*s.y/100.-sin(time*1.618)*s.x*s.y/888.,s.x/8.-sin(time*-.618)*s.y/s.x/2000.,1.-sin(time*2.618)*s.x/20.);
                                          

            return clamp(o,0.,1.);}

              vec3 tokogae (vec2 p, vec2 t){
                  vec2 s = p*2.;
                   float l=1.;
                  vec3 digorno;

                   for (int f=0;f<41;f+=1)if(abs(s.y)<5.){s=vec2(s.x+s.y/(s.x*s.x + s.y*s.y), (1./(s.x*s.x + s.y*s.y))-sin(1.-t.x)/2.);//this equation comes from the equation (x-1/((x - y*i)))=x


                  s.y=s.y-log(dot(s.y,s.y))*-sin((1.-t.x)/2.);
                  digorno+=vec3(s.x,s.x/s.y,(s.y/s.x));
                  }
                  else         digorno-=vec3(s.x*1.4,(s.y*s.x),s.y)/50.;

                  return digorno/4.;
              }


      vec3 TOLTOK (vec2 p, vec2 t){
                            t.x*=1.5;
                  vec2 s = p*1.5;
                   float l=1.;
                  vec3 digorno=vec3(0.);
                   for (int f=0;f<21;f+=1)if(abs(s.y)<5.){
                       if(f>0) s=vec2(s.x+s.y/(s.x*s.x + s.y*s.y), (1./(s.x*s.x + s.y*s.y))+t.x-1.);//this equation comes from the equation (x-1/((x - y*i)))=x.  This equation has no solutions, but upon feedback it gains solutions (technically this may require other steps too)
                       for (int counter=0;counter<10;counter+=1)if(abs(s.y)<1.5*(1.-t.x)){
                            s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y);//x**3
                            s.x=log(abs(s.x));
                            }
                  l = s.x-l;

                  //s.y=s.y-log(dot(s.y,s.y))*-sin((1.-t.x)/2.);
                  digorno+=vec3((s.y/s.x),(s.y/s.x)*5.+l*s.y,s.x);
                  }
                  	else 		digorno-=vec3(s.x*1.4,(s.y*s.x),s.y)/21.;

                  return digorno/8.;
              }


  vec3 TOLTOK1    (vec2 s, vec2 t){
                            s=-s.yx;
                            vec2 p = s;
    vec3 ret = vec3(1.);
      for (int f=0;f<20;f+=1)if(abs(s.y)<30.){
          if (f<10)
          for (int p=0;p<2;p+=1)if(abs(s.y)<(1.-t.x)*2.)
          {
          s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y);//x**3
              s.x=log(abs(s.x));
              ret+=vec3(s.y/100.-s.x*s.y/888.,s.x/8.-s.y/s.x/2000.,1.-s.x/20.)/20.;
             }
          if (f>3){ s=vec2((s.x+s.y/(s.x*s.x + s.y*s.y)), (1./(s.x*s.x + s.y*s.y)))-abs(p);
          s.y=s.y-log(dot(s.y,s.y))*-sin(1.-t.x);
          ret= vec3(s.y,abs(s.x-s.y),s.y*s.x)/50.;
                    }
      }
      return ret;
}


               
vec3 xx(vec2 s, vec2 t){
      for (int f=0;f<40;f+=1)if(abs(s.y)<19.){
          s=vec2((s.x*s.x-s.y*s.y)-t.x, 2.0*s.x*s.y)-t.y;//this is {s^2}
  s.x=log(abs(s.x));
}

  return vec3(s.x,s.y,0.);}
vec3 xtol(vec2 s, vec2 t){
                                  float cored=   log(zoom*1.75)/log(.75)+1.;
                                        float h =1.3333333;
                                            float loops=1.;
                                        if(cored>1.&&MetaCored)
                                         {
                                             float c = sqrt(s.y*s.y+s.x*s.x);
                                             c/=h;
                                             {for(int i = 0; i<69+1; i++)if(c<h/2.&&loops<cored){s*=h;c*=h;loops++;}
                                                                                           
                                                                                           }
                                         }
                                                                                            
                            for (int f=0;f<40;f+=1)if(abs(s.y)<19.){
                            if(mod(float(f),3.)==0.)s=vec2(s.x*s.x*s.x  - 3.*s.x*s.y*s.y, -s.y*s.y*s.y+ 3.*s.x*s.x*s.y);//x**3
                            s=vec2((s.x*s.x-s.y*s.y), 2.0*s.x*s.y);//this is {s^2-p;s.real=-1./s.real}
                                    s.x=log(abs(s.x));
                                    
                                    if(MetaCored){
                                        float c = sqrt(s.y*s.y+s.x*s.x);
                                        //for(int i=0;i<69; i++)if(c<2./3.&&i<int(cored)){p*=2.;c*=2.;}
                                        c/=h;
                                        if(c<h/2. &&f<int((cored/2.+log(length(freed(coords))*h/2.)+.5)/2.)){float shift=h;s*=shift;c*=shift;}
                                                                 }
                                                                                      }
                        
                           return vec3(s.y/50.-s.x*s.y/600.,s.x/8.-s.y/s.x/200.,1.-s.x/10.);
                           
                        }


          vec3 body(vec2 p, vec2 t){return torso(p,t)+musculature(p,t)+robe(p,t)+legs(p,t);}
          vec3 bod(vec2 p, vec2 t){t*=zoom;return body(p,t)+heart(p,t);}
          vec3 manny(vec2 p, vec2 t){return body(p,t)+heart(p,t)+face(p,vec2(0.));}//+shiny(p,vec2(time,0.));}
          vec3 mannyX(vec2 p, vec2 t){return body(p,t)+excelsior(p,vec2(time*metronome,0.));}

          vec3 fourCreatures(vec2 p, vec2 t){
                    vec2 spacing = vec2(5.,3.)*.7;
                    p.x+=.5;

                    return eaglePerched(p+spacing,vec2(-1.,0.))+bod(p+spacing,t)+
                    lion(p+vec2(-spacing.x,spacing.y),vec2(-1.,0.))+bod(p+vec2(-spacing.x,spacing.y),t)+
                    ox(p+vec2(spacing.x,-spacing.y),vec2(-1.,0.))+bod(p+vec2(spacing.x,-spacing.y),t)+
                    man(p-spacing,vec2(-1.,0.))+bod(p-spacing,t)  ;
        }
          vec2 spin(vec2 p,float time_){
          float pixelangle = -atan(p.y,p.x)-(time_)/6.+3.14/8.;
          float pixeldistance = pow((p.y*p.y+p.x*p.x),.5);
          vec2 pTiltCoord =-vec2(pixeldistance*-cos(pixelangle),pixeldistance*-sin(pixelangle));
          return pTiltCoord;
          }

          //function library: manny body legs robe musculature torso face excelsior shiny lion ox man eagle eaglePerched fourCreatures heart anomalyze spin x
          void main(){
           vec2 p=-((vUv.yx)-.5)/(resolution.xy/max(resolution.x,resolution.y))*6.;
           
           vec2 bg =p/2.;
           vec2 bg2 =p/3.;

          float rate = 1.;
          vec2 t =vec2(-sin(rate*time2dance)/50.,-sin(time2dance*(rate*gr)*3.)/30.);
          //vec2 fl=vec2(-1.,-sin(time));//vec2(-sin(rate*time),-sin(time*(rate*gr)*3.));
          vec3 zoomer;
          bg=freed(bg*zoom+coords.yx);
          bg2=freed(bg2*zoom+coords.yx);

          vec2 dance = vec2(0.);
          if (morph>.5)  dance = (
          vec2(-sin(time+time2dance),-sin((time+time2dance)*-1.618))*zoom+
           (coords.yx+.5)*log(pow(zoom,1.618))/log(1.618)*zoom*.5
                              );
                              vec2 dance2 = vec2(0.);
                              if (morph>.5)  dance2 =  morph*vec2(length(freed(coords))/(length(freed(coords))-zoom)*sign(coords.y*coords.x)+length(freed(coords))*zoom,-((zoom*length(freed(coords)))/(length(freed(coords))+zoom)*sign(coords.y*coords.x)*(1.-length(freed(coords)*zoom)) ))*2./3.;

          vec2 driftCanceller=vec2(dance.x,-dance.y);
          
          
          if(colorCombo<10)zoomer=tol(bg, dance2);
          else if (colorCombo==11)zoomer=heartZoom(bg2+vec2(.5,0.)+driftCanceller, dance);
          else if (colorCombo==13)zoomer=tokogae(bg,vec2(zoom));
          else if (colorCombo==14)zoomer=TOLTOK(bg,vec2(zoom));
          else if (colorCombo==15)zoomer=xx(bg,dance2);
          else if (colorCombo==16)zoomer=xtol(bg,vec2(0.));
          else if (colorCombo==17)zoomer=body(bg,vec2(-sin(time*20.)/50.,-sin(time*gr*20.)/30.))+robe(bg,vec2(0.))/2.+faceHeights(bg,t)+                                                   heartZoom(bg-vec2(.5,0.)+driftCanceller,dance);
;
                                                   
          vec3 creatures,b;
          p.x+=.5;
          
          if(fourCreats<0){creatures=fourCreatures((bg)*4.,t);  b=bride((bg-vec2(.125,0.))*12.,vec2(time2dance));}
          vec3 mny=vec3(0.);
          vec3 m=vec3(0.);
            if(colorCombo!=17){
              if(metronome<1.) {mny = bride2manny(p*2.,vec2(time2dance))+robeL(p,vec2(time2dance))*.95;m=mny;}
              else   mny = mannyX(p,t);
              }
          gl_FragColor=vec4(mny+creatures+b+
                            clamp((zoomer+heart((p+vec2(.5,0.))/2.,t))-(m.r+m.b+m.g+creatures.r+creatures.g+creatures.b)*100.,.0,1.)
                    ,1.);}
        </script>
        <script src="starshipMod.js"></script>
        <script src="wadLoader.js"></script>
    </body>
</html>
